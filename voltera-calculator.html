<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Voltera Besparingscalculator - Bereken uw besparing met zonnepanelen, hybride warmtepomp en thuisbatterij">
    <meta name="author" content="Voltera">
    <meta name="version" content="1.0.0">
    <meta name="last-updated" content="2025-01-21">
    <title>Voltera Besparingscalculator</title>
    
    <!-- CSS Framework - Step 2 Complete -->
    <style>
        /* ===== CSS CUSTOM PROPERTIES ===== */
        :root {
            /* Brand Colors */
            --color-primary: #007BFF;
            --color-primary-dark: #0056CC;
            --color-primary-light: #3395FF;
            --color-secondary: #28A745;
            --color-success: #28A745;
            --color-warning: #FFC107;
            --color-danger: #DC3545;
            --color-info: #17A2B8;

            /* Neutral Colors */
            --color-white: #FFFFFF;
            --color-gray-50: #F8F9FA;
            --color-gray-100: #E9ECEF;
            --color-gray-200: #DEE2E6;
            --color-gray-300: #CED4DA;
            --color-gray-400: #6C757D;
            --color-gray-500: #495057;
            --color-gray-600: #343A40;
            --color-gray-700: #212529;
            --color-black: #000000;

            /* Semantic Colors */
            --color-text-primary: var(--color-gray-700);
            --color-text-secondary: var(--color-gray-500);
            --color-text-muted: var(--color-gray-400);
            --color-background: var(--color-gray-50);
            --color-surface: var(--color-white);
            --color-border: var(--color-gray-200);
            --color-border-light: var(--color-gray-100);

            /* Typography */
            --font-family-primary: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --font-family-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            
            --font-size-xs: 0.75rem;    /* 12px */
            --font-size-sm: 0.875rem;   /* 14px */
            --font-size-base: 1rem;     /* 16px */
            --font-size-lg: 1.125rem;   /* 18px */
            --font-size-xl: 1.25rem;    /* 20px */
            --font-size-2xl: 1.5rem;    /* 24px */
            --font-size-3xl: 1.875rem;  /* 30px */
            --font-size-4xl: 2.25rem;   /* 36px */

            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;

            --line-height-tight: 1.25;
            --line-height-normal: 1.5;
            --line-height-relaxed: 1.75;

            /* Spacing */
            --space-xs: 0.25rem;   /* 4px */
            --space-sm: 0.5rem;    /* 8px */
            --space-md: 0.75rem;   /* 12px */
            --space-lg: 1rem;      /* 16px */
            --space-xl: 1.5rem;    /* 24px */
            --space-2xl: 2rem;     /* 32px */
            --space-3xl: 3rem;     /* 48px */
            --space-4xl: 4rem;     /* 64px */

            /* Border Radius */
            --radius-sm: 0.25rem;   /* 4px */
            --radius-md: 0.5rem;    /* 8px */
            --radius-lg: 0.75rem;   /* 12px */
            --radius-xl: 1rem;      /* 16px */
            --radius-full: 9999px;

            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);

            /* Layout */
            --container-max-width: 768px;
            --header-height: 80px;
            --footer-height: 60px;
        }

        /* ===== RESET & BASE STYLES ===== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        *::before,
        *::after {
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            line-height: var(--line-height-normal);
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-family-primary);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-normal);
            color: var(--color-text-primary);
            background-color: var(--color-background);
            min-height: 100vh;
        }

        /* ===== TYPOGRAPHY ===== */
        h1, h2, h3, h4, h5, h6 {
            font-weight: var(--font-weight-semibold);
            line-height: var(--line-height-tight);
            margin-bottom: var(--space-sm);
        }

        h1 { font-size: var(--font-size-3xl); }
        h2 { font-size: var(--font-size-2xl); }
        h3 { font-size: var(--font-size-xl); }
        h4 { font-size: var(--font-size-lg); }
        h5 { font-size: var(--font-size-base); }
        h6 { font-size: var(--font-size-sm); }

        p {
            margin-bottom: var(--space-lg);
            line-height: var(--line-height-normal);
        }

        small {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        /* ===== LAYOUT SYSTEM ===== */
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            max-width: var(--container-max-width);
            margin: 0 auto;
            background: var(--color-surface);
            box-shadow: var(--shadow-lg);
        }

        .main-content {
            flex: 1;
            padding: var(--space-lg);
        }

        .section {
            margin-bottom: var(--space-2xl);
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-border);
            overflow: hidden;
        }

        .section-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
            padding: var(--space-lg);
            background: var(--color-gray-50);
            border-bottom: 1px solid var(--color-border);
        }

        .section-icon {
            font-size: var(--font-size-xl);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
        }

        /* ===== HEADER STYLES ===== */
        .app-header {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: var(--color-white);
            padding: var(--space-lg);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-md);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--space-lg);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .logo {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            flex-shrink: 0;
        }

        .header-text {
            display: flex;
            flex-direction: column;
        }

        .app-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-white);
            margin-bottom: 0;
        }

        .app-subtitle {
            font-size: var(--font-size-sm);
            opacity: 0.9;
            margin-bottom: 0;
        }

        .total-display {
            text-align: right;
            background: rgba(255, 255, 255, 0.1);
            padding: var(--space-md);
            border-radius: var(--radius-md);
            backdrop-filter: blur(10px);
        }

        .total-amount {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-white);
            line-height: 1;
        }

        .total-period {
            font-size: var(--font-size-sm);
            opacity: 0.9;
            margin-top: var(--space-xs);
        }

        .total-yearly {
            font-size: var(--font-size-xs);
            opacity: 0.8;
            margin-top: var(--space-xs);
        }

        /* ===== FORM STYLES ===== */
        .input-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-lg);
            padding: var(--space-lg);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .input-label {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
            margin-bottom: var(--space-xs);
        }

        .input-field {
            width: 100%;
            padding: var(--space-md) var(--space-lg);
            font-size: var(--font-size-base);
            color: var(--color-text-primary);
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
            -webkit-appearance: none;
            appearance: none;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
            background: var(--color-white);
        }

        .input-field:invalid:not(:placeholder-shown) {
            border-color: var(--color-danger);
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
        }

        .input-field:disabled {
            background: var(--color-gray-50);
            color: var(--color-text-muted);
            cursor: not-allowed;
        }

        .input-field::placeholder {
            color: var(--color-text-muted);
            opacity: 1;
        }

        .input-helper {
            font-size: var(--font-size-xs);
            color: var(--color-text-muted);
            margin-top: var(--space-xs);
        }

        .percentage-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .percentage-input {
            padding-right: 30px;
        }

        .percentage-symbol {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-text-muted);
            font-weight: 500;
            pointer-events: none;
        }

        .euro-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .euro-input {
            padding-left: 30px;
        }

        .euro-symbol {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-text-muted);
            font-weight: 500;
            pointer-events: none;
        }

        .select-input {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 8px center;
            background-repeat: no-repeat;
            background-size: 16px 12px;
            padding-right: 40px;
        }

        .calc-row.success .calc-value {
            color: var(--color-success);
            font-weight: var(--font-weight-medium);
        }

        .input-error {
            font-size: var(--font-size-xs);
            color: var(--color-danger);
            margin-top: var(--space-xs);
            min-height: 1rem;
            display: block;
            opacity: 0;
            transform: translateY(-4px);
            transition: all var(--transition-fast);
        }

        .input-error.show {
            opacity: 1;
            transform: translateY(0);
        }

        .input-field.invalid {
            border-color: var(--color-danger);
            background-color: rgba(239, 68, 68, 0.05);
            box-shadow: 0 0 0 1px rgba(239, 68, 68, 0.2);
        }

        .input-field.valid {
            border-color: var(--color-success);
            background-color: rgba(34, 197, 94, 0.05);
        }

        .input-field.valid + .input-success {
            opacity: 1;
            transform: translateY(0);
        }

        .input-success {
            display: block;
            font-size: var(--font-size-xs);
            color: var(--color-success);
            margin-top: var(--space-xs);
            min-height: 1rem;
            opacity: 0;
            transform: translateY(-4px);
            transition: all var(--transition-fast);
        }

        .customer-progress {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
            padding: var(--space-md);
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(34, 197, 94, 0.05));
            border-radius: var(--border-radius);
            border-left: 4px solid var(--color-success);
        }

        .customer-progress.incomplete {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(251, 191, 36, 0.05));
            border-left-color: var(--color-warning);
        }

        .progress-icon {
            font-size: var(--font-size-lg);
        }

        .progress-text {
            flex: 1;
            font-size: var(--font-size-sm);
        }

        .progress-text strong {
            color: var(--color-text);
        }

        .number-input {
            font-variant-numeric: tabular-nums;
            text-align: right;
        }

        /* ===== PRODUCT SECTIONS ===== */
        .product-section {
            transition: all var(--transition-normal);
        }

        .product-section.enabled {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 1px var(--color-primary);
        }

        .section-header {
            padding: var(--space-lg);
            background: var(--color-gray-50);
            border-bottom: 1px solid var(--color-border);
        }

        .product-toggle {
            display: flex;
            align-items: center;
        }

        .product-checkbox {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid var(--color-border);
            border-radius: var(--radius-sm);
            margin-right: var(--space-md);
            position: relative;
            cursor: pointer;
            transition: all var(--transition-fast);
            flex-shrink: 0;
        }

        .product-checkbox:checked {
            background: var(--color-primary);
            border-color: var(--color-primary);
        }

        .product-checkbox:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--color-white);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-bold);
        }

        .product-toggle-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            cursor: pointer;
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
            transition: color var(--transition-fast);
        }

        .product-toggle-label:hover {
            color: var(--color-primary);
        }

        .product-title {
            margin-left: var(--space-sm);
            flex: 1;
        }

        .product-savings {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            color: var(--color-success);
            background: rgba(40, 167, 69, 0.1);
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-full);
            transition: all var(--transition-fast);
        }

        .product-content {
            display: none;
            animation: slideDown var(--transition-normal);
        }

        .section.enabled .product-content {
            display: block;
        }

        /* ===== CALCULATION DISPLAY ===== */
        .calculation-display {
            margin-top: var(--space-lg);
            padding: var(--space-lg);
            background: var(--color-gray-50);
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border-light);
        }

        .calc-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-sm) 0;
            border-bottom: 1px solid var(--color-border-light);
        }

        .calc-row:last-child {
            border-bottom: none;
        }

        .calc-row.highlight {
            background: linear-gradient(90deg, rgba(40, 167, 69, 0.05), rgba(40, 167, 69, 0.1));
            margin: var(--space-sm) calc(-1 * var(--space-lg));
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-md);
            border-bottom: none;
        }

        .calc-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-medium);
        }

        .calc-value {
            font-size: var(--font-size-base);
            color: var(--color-text-primary);
            font-weight: var(--font-weight-semibold);
            font-variant-numeric: tabular-nums;
            text-align: right;
        }

        .calc-row.highlight .calc-value {
            color: var(--color-success);
            font-weight: var(--font-weight-bold);
        }

        /* ===== BUTTONS ===== */
        .primary-button,
        .secondary-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            padding: var(--space-lg) var(--space-xl);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            text-decoration: none;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
            min-height: 48px;
        }

        .primary-button {
            background: var(--color-primary);
            color: var(--color-white);
        }

        .primary-button:hover:not(:disabled) {
            background: var(--color-primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .primary-button:active:not(:disabled) {
            transform: translateY(0);
        }

        .primary-button:disabled {
            background: var(--color-gray-300);
            color: var(--color-text-muted);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .secondary-button {
            background: var(--color-gray-100);
            color: var(--color-text-primary);
            border: 1px solid var(--color-border);
        }

        .secondary-button:hover:not(:disabled) {
            background: var(--color-gray-200);
            border-color: var(--color-gray-300);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .button-icon {
            font-size: var(--font-size-lg);
        }

        .button-text {
            font-weight: var(--font-weight-medium);
        }

        .button-loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: var(--font-size-lg);
            animation: spin 1s linear infinite;
        }
        
        /* ===== FUNDS SECTION ===== */
        .funds-section {
            background: linear-gradient(135deg, var(--color-gray-50), var(--color-white));
            border: 2px solid var(--color-secondary);
        }
        
        .funds-content {
            padding: var(--space-xl);
        }
        
        .funds-input-section {
            margin-bottom: var(--space-xl);
            padding: var(--space-lg);
            background: var(--color-white);
            border-radius: var(--border-radius);
            border: 1px solid var(--color-border);
        }
        
        .financial-summary {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
            border-radius: var(--border-radius-lg);
            padding: var(--space-xl);
            border: 1px solid rgba(99, 102, 241, 0.1);
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }
        
        .summary-card {
            background: var(--color-white);
            padding: var(--space-lg);
            border-radius: var(--border-radius);
            border: 1px solid var(--color-border);
            text-align: center;
            transition: all var(--transition-normal);
        }
        
        .summary-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .summary-card.highlight {
            border-color: var(--color-success);
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.05), var(--color-white));
        }
        
        .summary-card-title {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-sm);
        }
        
        .summary-card-value {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
            margin-bottom: var(--space-xs);
            font-variant-numeric: tabular-nums;
        }
        
        .summary-card.highlight .summary-card-value {
            color: var(--color-success);
        }
        
        .summary-card-detail {
            font-size: var(--font-size-xs);
            color: var(--color-text-tertiary);
        }
        
        .roi-section {
            border-top: 1px solid var(--color-border);
            padding-top: var(--space-lg);
        }
        
        .roi-header {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            text-align: center;
            margin-bottom: var(--space-lg);
        }
        
        .roi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
        }
        
        .roi-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md);
            background: rgba(255, 255, 255, 0.5);
            border-radius: var(--border-radius);
            border: 1px solid rgba(99, 102, 241, 0.1);
        }
        
        .roi-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-medium);
        }
        
        .roi-value {
            font-size: var(--font-size-sm);
            color: var(--color-primary);
            font-weight: var(--font-weight-bold);
            font-variant-numeric: tabular-nums;
        }

        /* ===== ACTIONS SECTION ===== */
        .actions-section {
            background: linear-gradient(135deg, var(--color-gray-50), var(--color-white));
            border: 2px solid var(--color-primary);
        }

        .actions-content {
            padding: var(--space-2xl);
            text-align: center;
        }

        .total-summary {
            margin-bottom: var(--space-2xl);
        }

        .summary-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-md);
        }

        .summary-amount {
            font-size: var(--font-size-4xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-success);
            line-height: 1;
            margin-bottom: var(--space-sm);
            font-variant-numeric: tabular-nums;
        }

        .summary-yearly {
            font-size: var(--font-size-lg);
            color: var(--color-text-muted);
            font-weight: var(--font-weight-medium);
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
            align-items: center;
        }

        /* ===== FOOTER ===== */
        .app-footer {
            background: var(--color-gray-700);
            color: var(--color-white);
            padding: var(--space-lg);
            margin-top: auto;
        }

        .footer-content {
            text-align: center;
        }

        .footer-text {
            margin-bottom: var(--space-md);
        }

        .footer-text p {
            font-size: var(--font-size-sm);
            margin-bottom: var(--space-xs);
            opacity: 0.9;
        }

        .footer-disclaimer {
            padding-top: var(--space-md);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .footer-disclaimer small {
            color: rgba(255, 255, 255, 0.7);
            line-height: var(--line-height-relaxed);
        }

        /* ===== STATUS MESSAGES ===== */
        .status-messages {
            position: fixed;
            top: var(--space-lg);
            right: var(--space-lg);
            z-index: 1000;
            max-width: 400px;
        }

        .status-message {
            padding: var(--space-lg);
            margin-bottom: var(--space-md);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            animation: slideInRight var(--transition-normal);
            position: relative;
        }

        .status-message.success {
            background: var(--color-success);
            color: var(--color-white);
        }

        .status-message.error {
            background: var(--color-danger);
            color: var(--color-white);
        }

        .status-message.warning {
            background: var(--color-warning);
            color: var(--color-gray-700);
        }

        .status-message.info {
            background: var(--color-info);
            color: var(--color-white);
        }

        /* ===== CONFIGURATION PANEL ===== */
        .config-panel {
            position: fixed;
            top: var(--space-lg);
            left: var(--space-lg);
            background: var(--color-white);
            border: 2px solid var(--color-warning);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            max-width: 400px;
        }

        .config-panel h3 {
            color: var(--color-warning);
            margin-bottom: var(--space-lg);
            font-size: var(--font-size-lg);
        }

        .config-row {
            margin-bottom: var(--space-lg);
        }

        .config-row label {
            display: block;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            margin-bottom: var(--space-sm);
        }

        .config-row input {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-sm);
        }

        /* ===== ANIMATIONS ===== */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes spin {
            from {
                transform: translate(-50%, -50%) rotate(0deg);
            }
            to {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.02);
            }
        }

        .value-updated {
            animation: pulse var(--transition-slow);
        }

        .value-updated-strong {
            animation: pulseStrong 0.6s ease-in-out;
        }

        .calculating {
            position: relative;
            opacity: 0.7;
        }

        .calculating::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 1.5s infinite;
            border-radius: var(--border-radius);
        }

        @keyframes pulseStrong {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
            }
            25% { 
                transform: scale(1.05); 
                box-shadow: 0 0 0 8px rgba(34, 197, 94, 0.2);
            }
            50% { 
                transform: scale(1.02); 
                box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.1);
            }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .total-display .value-updated-strong {
            animation: totalPulse 0.8s ease-in-out;
        }

        @keyframes totalPulse {
            0%, 100% { 
                transform: scale(1); 
                color: var(--color-text);
            }
            25% { 
                transform: scale(1.08); 
                color: var(--color-success);
                text-shadow: 0 0 10px rgba(34, 197, 94, 0.3);
            }
            50% { 
                transform: scale(1.04); 
                color: var(--color-success);
            }
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (min-width: 640px) {
            .input-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .action-buttons {
                flex-direction: row;
                justify-content: center;
            }

            .header-content {
                gap: var(--space-2xl);
            }

            .app-title {
                font-size: var(--font-size-2xl);
            }

            .total-amount {
                font-size: var(--font-size-3xl);
            }
        }

        @media (min-width: 768px) {
            .input-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .main-content {
                padding: var(--space-2xl);
            }

            .app-header {
                padding: var(--space-2xl);
            }

            .summary-amount {
                font-size: clamp(var(--font-size-3xl), 8vw, var(--font-size-4xl));
            }
        }

        @media (max-width: 639px) {
            .header-content {
                flex-direction: column;
                gap: var(--space-lg);
                text-align: center;
            }

            .total-display {
                order: -1;
                margin-bottom: var(--space-lg);
            }

            .logo-section {
                justify-content: center;
            }
        }

        /* ===== PRINT STYLES ===== */
        @media print {
            .app-header,
            .app-footer,
            .action-buttons,
            .config-panel,
            .status-messages {
                display: none !important;
            }

            .app-container {
                box-shadow: none;
                max-width: none;
            }

            .section {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #000;
            }

            .product-content {
                display: block !important;
            }

            * {
                color: #000 !important;
                background: #fff !important;
            }
        }

        /* ===== ACCESSIBILITY ===== */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus indicators for keyboard navigation */
        .product-checkbox:focus,
        .input-field:focus,
        .primary-button:focus,
        .secondary-button:focus {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
        }
        /* Debug Panel Styles - Step 10 */
        .debug-button {
            background: #6366f1;
            color: white;
            border: 2px solid #6366f1;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            min-width: 120px;
            justify-content: center;
        }

        .debug-button:hover {
            background: #4f46e5;
            border-color: #4f46e5;
            transform: translateY(-1px);
        }

        .debug-section {
            margin-top: 20px;
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            animation: slideDown 0.3s ease-out;
        }

        .debug-tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            padding: 0 20px;
            background: #ffffff;
            border-radius: 12px 12px 0 0;
        }

        .debug-tab {
            background: none;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-weight: 500;
            color: #64748b;
            border-bottom: 3px solid transparent;
            transition: all 0.2s ease;
        }

        .debug-tab.active {
            color: #6366f1;
            border-bottom-color: #6366f1;
        }

        .debug-tab:hover {
            color: #4f46e5;
            background: #f8fafc;
        }

        .debug-content {
            padding: 20px;
        }

        .debug-group {
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .debug-group h3 {
            margin: 0 0 15px 0;
            color: #1e293b;
            font-size: 16px;
            font-weight: 600;
        }

        .debug-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .debug-btn {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            color: #475569;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .debug-btn:hover {
            background: #e2e8f0;
            border-color: #94a3b8;
        }

        .debug-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            align-items: end;
        }

        .debug-input {
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .debug-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .debug-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .toggle-slider {
            position: relative;
            width: 50px;
            height: 24px;
            background: #cbd5e1;
            border-radius: 12px;
            transition: background 0.2s ease;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            top: 2px;
            left: 2px;
            transition: transform 0.2s ease;
        }

        .debug-toggle input:checked + .toggle-slider {
            background: #6366f1;
        }

        .debug-toggle input:checked + .toggle-slider::before {
            transform: translateX(26px);
        }

        .debug-toggle input {
            display: none;
        }

        .scenario-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .scenario-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .debug-textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background: #f8fafc;
            resize: vertical;
            margin-top: 15px;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                max-height: 1000px;
                transform: translateY(0);
            }
        }

        /* Mobile adjustments for debug panel */
        @media (max-width: 768px) {
            .debug-tabs {
                overflow-x: auto;
                padding: 0 10px;
            }

            .debug-tab {
                white-space: nowrap;
                padding: 12px 16px;
            }

            .debug-content {
                padding: 15px;
            }

            .debug-inputs {
                grid-template-columns: 1fr;
            }

            .scenario-item {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
        }

        /* Enhanced Validation Styles - Step 11 */
        .validation-message {
            font-size: 12px;
            margin-top: 4px;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .validation-message.success {
            color: #059669;
            background: #ecfdf5;
            border: 1px solid #d1fae5;
        }

        .validation-message.error {
            color: #dc2626;
            background: #fef2f2;
            border: 1px solid #fecaca;
        }

        .input-field.valid {
            border-color: #10b981;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.1);
        }

        .input-field.invalid,
        .input-field.error {
            border-color: #ef4444;
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.1);
        }
        
        /* Remove red border from gas usage field */
        #gas-usage.error {
            border-color: #d1d5db;
            box-shadow: 0 0 0 2px rgba(209, 213, 219, 0.1);
        }

        /* Number inputs with validation */
        input[type="number"].valid,
        input[type="tel"].valid,
        input[type="email"].valid,
        input[type="text"].valid {
            border-color: #10b981;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.1);
        }

        input[type="number"].invalid,
        input[type="number"].error,
        input[type="tel"].invalid,
        input[type="tel"].error,
        input[type="email"].invalid,
        input[type="email"].error,
        input[type="text"].invalid,
        input[type="text"].error {
            border-color: #ef4444;
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.1);
        }

        /* Error boundary styles for calculation errors */
        .calculation-error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            margin: 8px 0;
        }

        .calculation-warning {
            background: #fffbeb;
            border: 1px solid #fed7aa;
            color: #d97706;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            margin: 8px 0;
        }

        /* Desktop-Focused UI Polish - Step 12 */
        
        /* Enhanced hover effects for desktop interaction */
        .product-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .product-toggle:hover .toggle-label {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            transform: scale(1.02);
        }

        .input-field:hover {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .input-field:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        /* Professional button enhancements */
        .primary-button, .secondary-button, .debug-button {
            position: relative;
            overflow: hidden;
        }

        .primary-button::before,
        .secondary-button::before,
        .debug-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }

        .primary-button:hover::before,
        .secondary-button:hover::before,
        .debug-button:hover::before {
            left: 100%;
        }

        /* Enhanced loading state */
        .primary-button.loading {
            position: relative;
            pointer-events: none;
        }

        .primary-button.loading .button-text {
            opacity: 0.7;
        }

        .primary-button.loading .button-loader {
            display: inline-block !important;
            animation: spin 1s linear infinite;
            margin-left: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Smooth value transitions */
        .calculation-result,
        .total-amount,
        .summary-amount {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .calculation-result.updating,
        .total-amount.updating,
        .summary-amount.updating {
            transform: scale(1.05);
            color: #6366f1;
        }

        /* Enhanced keyboard focus indicators */
        button:focus-visible,
        input:focus-visible,
        .product-toggle:focus-visible {
            outline: 2px solid #6366f1;
            outline-offset: 2px;
            border-radius: 4px;
        }

        /* Professional tooltips */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .tooltip::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(6px);
            border: 5px solid transparent;
            border-top-color: #1f2937;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover::after,
        .tooltip:hover::before {
            opacity: 1;
        }

        /* Enhanced section headers */
        .section-title {
            position: relative;
            padding-bottom: 8px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            border-radius: 2px;
        }

        /* Desktop-optimized layout improvements */
        .app-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 24px;
        }

        .main-content {
            display: grid;
            gap: 24px;
            padding: 24px 0;
        }

        /* Professional progress indicator */
        .progress-indicator {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: rgba(99, 102, 241, 0.1);
            z-index: 1000;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Enhanced summary section */
        .actions-section {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border: 2px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }

        .actions-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #6366f1, #8b5cf6, #06b6d4);
        }

        /* Professional data presentation */
        .calculation-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 12px 0;
        }

        .calculation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(99, 102, 241, 0.05);
            border-radius: 6px;
            border-left: 3px solid #6366f1;
        }

        .calculation-label {
            font-weight: 500;
            color: #374151;
        }

        .calculation-value {
            font-weight: 600;
            color: #6366f1;
        }

        /* Smooth state transitions */
        .section-content {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .section-disabled .section-content {
            opacity: 0.6;
            pointer-events: none;
            transform: translateY(-5px);
        }

        /* Professional validation states */
        .validation-message {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Enhanced interactive elements */
        .interactive-element {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .interactive-element:hover {
            transform: translateY(-1px);
        }

        .interactive-element:active {
            transform: translateY(0);
        }
        
        /* ===== STEP 12: ADDITIONAL CSS FOR DESKTOP-FOCUSED ENHANCEMENTS ===== */
        
        /* Status message system */
        .status-messages {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            max-width: 400px;
        }

        .status-message {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            min-width: 300px;
        }

        .status-message.show {
            opacity: 1;
            transform: translateX(0);
        }

        .status-message.status-success {
            background: #d1fae5;
            border: 1px solid #10b981;
            color: #065f46;
        }

        .status-message.status-error {
            background: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
        }

        .status-message.status-info {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            color: #1e40af;
        }

        .status-icon {
            font-size: 16px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .status-text {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
        }

        .status-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: inherit;
            opacity: 0.6;
            flex-shrink: 0;
        }

        .status-close:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 50%;
        }

        /* Enhanced animations for desktop interactions */
        .animate-in {
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Professional loading states */
        .primary-button.loading {
            position: relative;
            color: transparent;
        }

        .primary-button.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-right-color: transparent;
            animation: spin 0.8s linear infinite;
        }

        /* Enhanced keyboard focus for desktop accessibility */
        *:focus-visible {
            outline: 2px solid #6366f1;
            outline-offset: 2px;
            border-radius: 4px;
        }

        /* Smooth transitions for all interactive elements */
        input, button, .product-toggle, .section-content {
            transition: all 0.2s ease;
        }

        /* Professional hover states for desktop */
        .product-section {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: default;
        }

        /* Enhanced progress bar styling */
        .progress-indicator {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .progress-indicator.active {
            opacity: 1;
        }

        .progress-bar {
            background: linear-gradient(90deg, #6366f1, #8b5cf6, #06b6d4);
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.3);
        }

        /* Desktop-optimized tooltips and help text */
        .help-text {
            font-size: 13px;
            color: #6b7280;
            margin-top: 4px;
            transition: color 0.2s ease;
        }

        input:focus + .help-text,
        input:focus-visible + .help-text {
            color: #6366f1;
        }

        /* Professional section transitions */
        .product-section.disabled {
            filter: grayscale(0.3);
            opacity: 0.7;
        }

        .product-section.disabled:hover {
            filter: grayscale(0);
            opacity: 1;
        }

        /* Smooth calculation updates */
        .calculation-result,
        .total-amount {
            position: relative;
            overflow: hidden;
        }

        .calculation-result.updating::after,
        .total-amount.updating::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.2), transparent);
            animation: shimmer 1s ease-in-out;
        }

    </style>
</head>
<body>
    <!-- Configuration Panel (hidden in production) -->
    <div id="config-panel" class="config-panel" style="display: none;">
        <h3>🔧 Configuratie (Test Mode)</h3>
        <div class="config-row">
            <label>N8N Webhook URL:</label>
            <input type="url" id="webhook-url" placeholder="https://your-n8n.com/webhook/lm2zcQ28eiJKSfg2">
        </div>
        <div class="config-row">
            <label>Adviseur Naam:</label>
            <input type="text" id="advisor-name" placeholder="Jan van der Berg">
        </div>
        <div class="config-row">
            <label>Afspraak Link:</label>
            <input type="url" id="appointment-link" placeholder="https://calendly.com/voltera">
        </div>
        <button type="button" id="save-config">💾 Opslaan</button>
        <button type="button" id="test-data">🧪 Test Data</button>
    </div>

    <!-- Main Application -->
    <div id="app" class="app-container">
        <!-- Header Section -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo-section">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzAwN0JGRiIvPgo8dGV4dCB4PSIyMCIgeT0iMjYiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5WPC90ZXh0Pgo8L3N2Zz4K" alt="Voltera" class="logo">
                    <div class="header-text">
                        <h1 class="app-title">Besparingscalculator</h1>
                        <p class="app-subtitle">Bereken uw energiebesparing</p>
                    </div>
                </div>
                <div id="total-display" class="total-display">
                    <div class="total-amount">€0</div>
                    <div class="total-period">per maand</div>
                    <div class="total-yearly">(€0/jaar)</div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Customer Information Section -->
            <section id="customer-section" class="section customer-section">
                <h2 class="section-title">
                    <span class="section-icon">👤</span>
                    Klantgegevens
                </h2>
                
                <!-- Progress Indicator -->
                <div class="customer-progress incomplete" id="customer-progress">
                    <div class="progress-icon">⚠️</div>
                    <div class="progress-text">
                        <strong>Verplichte velden ontbreken</strong><br>
                        <span id="progress-detail">Vul uw voornaam, achternaam en email adres in om door te gaan.</span>
                    </div>
                </div>
                
                <div class="input-grid">
                    <div class="input-group">
                        <label for="customer-name" class="input-label">Voornaam *</label>
                        <input 
                            type="text" 
                            id="customer-name" 
                            name="customerName" 
                            class="input-field required" 
                            placeholder="bijv. Jan"
                            required
                            autocomplete="given-name"
                            maxlength="50"
                        >
                        <span class="input-error" id="customer-name-error"></span>
                        <span class="input-success" id="customer-name-success">✓ Voornaam ingevuld</span>
                    </div>
                    <div class="input-group">
                        <label for="customer-lastname" class="input-label">Achternaam *</label>
                        <input 
                            type="text" 
                            id="customer-lastname" 
                            name="customerLastname" 
                            class="input-field required" 
                            placeholder="bijv. de Vries"
                            required
                            autocomplete="family-name"
                            maxlength="50"
                        >
                        <span class="input-error" id="customer-lastname-error"></span>
                        <span class="input-success" id="customer-lastname-success">✓ Achternaam ingevuld</span>
                    </div>
                    <div class="input-group">
                        <label for="customer-email" class="input-label">Email *</label>
                        <input 
                            type="email" 
                            id="customer-email" 
                            name="customerEmail" 
                            class="input-field required" 
                            placeholder="bijv. jan@example.com"
                            required
                            autocomplete="email"
                            maxlength="100"
                        >
                        <span class="input-error" id="customer-email-error"></span>
                        <span class="input-success" id="customer-email-success">✓ Email adres geldig</span>
                    </div>
                    <div class="input-group">
                        <label for="agent-name" class="input-label">Agent</label>
                        <select 
                            id="agent-name-select" 
                            name="agentNameSelect" 
                            class="input-field"
                        >
                            <option value="">Selecteer agent...</option>
                            <option value="Feeke Geerts">Feeke Geerts</option>
                            <option value="Giovanni Chotkan">Giovanni Chotkan</option>
                            <option value="Justin Anches">Justin Anches</option>
                            <option value="Benjamin van der Lande">Benjamin van der Lande</option>
                            <option value="Catharina Over">Catharina Over</option>
                            <option value="David van der Linde">David van der Linde</option>
                            <option value="Coen van der Does">Coen van der Does</option>
                            <option value="custom">Anders...</option>
                        </select>
                        <input 
                            type="text" 
                            id="agent-name-custom" 
                            name="agentNameCustom" 
                            class="input-field" 
                            placeholder="Naam invullen"
                            style="display: none; margin-top: 8px;"
                            maxlength="50"
                        >
                        <span class="input-success" id="agent-name-success">✓ Agent geselecteerd</span>
                    </div>
                </div>
            </section>

            <!-- Solar Panels Section -->
            <section id="solar-section" class="section product-section" data-product="solar">
                <div class="section-header">
                    <div class="product-toggle">
                        <input type="checkbox" id="solar-enabled" class="product-checkbox">
                        <label for="solar-enabled" class="product-toggle-label">
                            <span class="section-icon">☀️</span>
                            <span class="product-title">Zonnepanelen</span>
                            <span class="product-savings" id="solar-savings-preview">€0/jaar</span>
                        </label>
                    </div>
                </div>
                <div class="product-content" id="solar-content">
                    <div class="input-group">
                        <label for="solar-panels" class="input-label">Aantal panelen</label>
                        <input 
                            type="number" 
                            id="solar-panels" 
                            name="solarPanels" 
                            class="input-field number-input" 
                            min="0" 
                            max="100" 
                            step="1"
                            placeholder="bijv. 12"
                        >
                        <span class="input-helper">400 kWh opbrengst per paneel per jaar</span>
                        <span class="input-error" id="solar-panels-error"></span>
                    </div>
                    <div class="input-group">
                        <label for="solar-percentage" class="input-label">Opbrengst percentage</label>
                        <div class="percentage-input-wrapper">
                            <input 
                                type="number" 
                                id="solar-percentage" 
                                name="solarPercentage" 
                                class="input-field number-input percentage-input" 
                                min="1" 
                                max="150" 
                                step="1"
                                value="100"
                                placeholder="100"
                            >
                            <span class="percentage-symbol">%</span>
                        </div>
                        <span class="input-helper">Bijstelling van de opbrengst (bijv. 90% door schaduw)</span>
                        <span class="input-error" id="solar-percentage-error"></span>
                    </div>
                    <div class="calculation-display" id="solar-calculations">
                        <div class="calc-row">
                            <span class="calc-label">Opwek per jaar:</span>
                            <span class="calc-value" id="solar-kwh">0 kWh</span>
                        </div>
                        <div class="calc-row highlight">
                            <span class="calc-label">Besparing:</span>
                            <span class="calc-value calculation-result" id="solar-savings">€0/maand (€0/jaar)</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Heat Pump Section -->
            <section id="heatpump-section" class="section product-section" data-product="heatpump">
                <div class="section-header">
                    <div class="product-toggle">
                        <input type="checkbox" id="heatpump-enabled" class="product-checkbox">
                        <label for="heatpump-enabled" class="product-toggle-label">
                            <span class="section-icon">🔥</span>
                            <span class="product-title">Hybride Warmtepomp</span>
                            <span class="product-savings" id="heatpump-savings-preview">€0/jaar</span>
                        </label>
                    </div>
                </div>
                <div class="product-content" id="heatpump-content">
                    <div class="input-group">
                        <label for="gas-usage" class="input-label">Gasverbruik per jaar (m³)</label>
                        <input 
                            type="number" 
                            id="gas-usage" 
                            name="gasUsage" 
                            class="input-field number-input" 
                            min="0" 
                            max="5000" 
                            step="1"
                            placeholder="bijv. 1500"
                        >
                        <span class="input-helper">Totaal gasverbruik inclusief warm water</span>
                        <span class="input-error" id="gas-usage-error"></span>
                    </div>
                    <div class="input-group">
                        <label for="household-size" class="input-label">Aantal personen in huis</label>
                        <input 
                            type="number" 
                            id="household-size" 
                            name="householdSize" 
                            class="input-field number-input" 
                            min="1" 
                            max="10" 
                            step="1"
                            placeholder="bijv. 4"
                        >
                        <span class="input-helper">80 m³ tapwater per persoon</span>
                        <span class="input-error" id="household-size-error"></span>
                    </div>
                    <div class="calculation-display" id="heatpump-calculations">
                        <div class="calc-row">
                            <span class="calc-label">Gas voor verwarming:</span>
                            <span class="calc-value" id="heatpump-heating-gas">0 m³</span>
                        </div>
                        <div class="calc-row">
                            <span class="calc-label">Besparing gas:</span>
                            <span class="calc-value" id="heatpump-saved-gas">0 m³ (70%)</span>
                        </div>
                        <div class="calc-row highlight">
                            <span class="calc-label">Besparing:</span>
                            <span class="calc-value calculation-result" id="heatpump-savings">€0/maand (€0/jaar)</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Battery Section -->
            <section id="battery-section" class="section product-section" data-product="battery">
                <div class="section-header">
                    <div class="product-toggle">
                        <input type="checkbox" id="battery-enabled" class="product-checkbox">
                        <label for="battery-enabled" class="product-toggle-label">
                            <span class="section-icon">🔋</span>
                            <span class="product-title">Thuisbatterij</span>
                            <span class="product-savings" id="battery-savings-preview">€0/jaar</span>
                        </label>
                    </div>
                </div>
                <div class="product-content" id="battery-content">
                    <div class="input-group">
                        <label for="battery-capacity" class="input-label">Capaciteit (kWh)</label>
                        <input 
                            type="number" 
                            id="battery-capacity" 
                            name="batteryCapacity" 
                            class="input-field number-input" 
                            min="0" 
                            max="50" 
                            step="0.5"
                            placeholder="bijv. 10"
                        >
                        <span class="input-helper">Batterijcapaciteit in kilowattuur</span>
                        <span class="input-error" id="battery-capacity-error"></span>
                    </div>
                    <div class="calculation-display" id="battery-calculations">
                        <div class="calc-row">
                            <span class="calc-label">Onbalanshandel:</span>
                            <span class="calc-value" id="battery-imbalance">€0/jaar</span>
                        </div>
                        <div class="calc-row">
                            <span class="calc-label">Terugleverkosten:</span>
                            <span class="calc-value" id="battery-feedin">€256/jaar</span>
                        </div>
                        <div class="calc-row highlight">
                            <span class="calc-label">Totale besparing:</span>
                            <span class="calc-value calculation-result" id="battery-savings">€0/maand (€0/jaar)</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Financing Calculator Section -->
            <section id="financing-section" class="section financing-section">
                <div class="section-header">
                    <div class="section-toggle">
                        <input type="checkbox" id="financing-enabled" class="product-checkbox">
                        <label for="financing-enabled" class="product-label">
                            <div class="product-icon">💰</div>
                            <div class="product-name">Financiering</div>
                            <div class="product-preview" id="financing-preview">Bereken maandlasten</div>
                        </label>
                    </div>
                </div>
                <div class="product-content" id="financing-content">
                    <div class="input-group">
                        <label for="loan-amount" class="input-label">Financieringsbedrag</label>
                        <div class="euro-input-wrapper">
                            <span class="euro-symbol">€</span>
                            <input 
                                type="number" 
                                id="loan-amount" 
                                name="loanAmount" 
                                class="input-field number-input euro-input" 
                                min="1000" 
                                max="100000" 
                                step="100"
                                placeholder="25000"
                            >
                        </div>
                        <span class="input-helper">Totale kosten van zonnepanelen, warmtepomp en batterij</span>
                        <span class="input-error" id="loan-amount-error"></span>
                    </div>
                    <div class="input-group">
                        <label for="loan-term" class="input-label">Looptijd</label>
                        <select id="loan-term" name="loanTerm" class="input-field select-input">
                            <option value="">Selecteer looptijd</option>
                            <option value="5">5 jaar</option>
                            <option value="8">8 jaar</option>
                            <option value="10">10 jaar</option>
                            <option value="12">12 jaar</option>
                            <option value="15">15 jaar</option>
                            <option value="20">20 jaar</option>
                            <option value="25">25 jaar</option>
                            <option value="30">30 jaar</option>
                        </select>
                        <span class="input-helper">Aantal jaren voor terugbetaling</span>
                        <span class="input-error" id="loan-term-error"></span>
                    </div>
                    <div class="input-group">
                        <label for="interest-rate" class="input-label">Rentepercentage</label>
                        <div class="percentage-input-wrapper">
                            <input 
                                type="number" 
                                id="interest-rate" 
                                name="interestRate" 
                                class="input-field number-input percentage-input" 
                                min="0.1" 
                                max="15" 
                                step="0.1"
                                value="4.5"
                                placeholder="4.5"
                            >
                            <span class="percentage-symbol">%</span>
                        </div>
                        <span class="input-helper">Jaarlijks rentepercentage van de lening</span>
                        <span class="input-error" id="interest-rate-error"></span>
                    </div>
                    <div class="calculation-display" id="financing-calculations">
                        <div class="calc-row">
                            <span class="calc-label">Maandlast:</span>
                            <span class="calc-value" id="monthly-payment">€0</span>
                        </div>
                        <div class="calc-row">
                            <span class="calc-label">Totale rente:</span>
                            <span class="calc-value" id="total-interest">€0</span>
                        </div>
                        <div class="calc-row">
                            <span class="calc-label">Totaal te betalen:</span>
                            <span class="calc-value" id="total-payment">€0</span>
                        </div>
                        <div class="calc-row highlight">
                            <span class="calc-label">Netto maandlast:</span>
                            <span class="calc-value calculation-result" id="net-monthly-cost">€0/maand</span>
                        </div>
                        <div class="calc-row success">
                            <span class="calc-label">Terugverdientijd:</span>
                            <span class="calc-value" id="payback-period">0 jaar</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Own Funds & Financial Summary Section -->
            <section id="funds-section" class="section funds-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">💰</span>
                        Financiële Overzicht
                    </h2>
                </div>
                <div class="funds-content">
                    <div class="funds-input-section">
                        <div class="input-group">
                            <label for="own-funds" class="input-label">Eigen Vermogen</label>
                            <div class="input-wrapper">
                                <span class="input-prefix">€</span>
                                <input type="number" 
                                       id="own-funds" 
                                       class="form-input" 
                                       placeholder="0"
                                       min="0" 
                                       max="100000" 
                                       step="1000">
                            </div>
                            <span class="input-help">Bedrag dat u zelf wilt investeren</span>
                        </div>
                    </div>
                    
                    <div class="financial-summary">
                        <div class="summary-grid">
                            <div class="summary-card">
                                <div class="summary-card-title">Totale Projectkosten</div>
                                <div class="summary-card-value" id="total-project-cost">€0</div>
                                <div class="summary-card-detail" id="project-cost-breakdown">Zonnepanelen + Warmtepomp + Batterij</div>
                            </div>
                            
                            <div class="summary-card">
                                <div class="summary-card-title">Eigen Vermogen</div>
                                <div class="summary-card-value" id="own-funds-display">€0</div>
                                <div class="summary-card-detail">Uw eigen investering</div>
                            </div>
                            
                            <div class="summary-card">
                                <div class="summary-card-title">Financieringsbehoefte</div>
                                <div class="summary-card-value" id="financing-need">€0</div>
                                <div class="summary-card-detail">Te financieren bedrag</div>
                            </div>
                            
                            <div class="summary-card highlight">
                                <div class="summary-card-title">Netto Voordeel</div>
                                <div class="summary-card-value" id="net-benefit-monthly">€0/maand</div>
                                <div class="summary-card-detail" id="net-benefit-yearly">(€0/jaar)</div>
                            </div>
                        </div>
                        
                        <div class="roi-section">
                            <div class="roi-header">Rendement Analyse</div>
                            <div class="roi-grid">
                                <div class="roi-item">
                                    <span class="roi-label">Terugverdientijd:</span>
                                    <span class="roi-value" id="payback-period">Direct rendabel</span>
                                </div>
                                <div class="roi-item">
                                    <span class="roi-label">Totaal voordeel (10 jaar):</span>
                                    <span class="roi-value" id="total-benefit-10y">€0</span>
                                </div>
                                <div class="roi-item">
                                    <span class="roi-label">ROI percentage:</span>
                                    <span class="roi-value" id="roi-percentage">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Actions Section -->
            <section id="actions-section" class="section actions-section">
                <div class="actions-content">
                    <div class="total-summary">
                        <div class="summary-title">Totale Besparing</div>
                        <div class="summary-amount" id="final-total-month">€0 per maand</div>
                        <div class="summary-yearly" id="final-total-year">(€0 per jaar)</div>
                    </div>
                    <div class="action-buttons">
                        <button type="button" id="generate-email" class="primary-button" disabled>
                            <span class="button-icon">📧</span>
                            <span class="button-text">Genereer Email Concept</span>
                            <span class="button-loader" id="email-loader" style="display: none;">⏳</span>
                        </button>
                        <button type="button" id="reset-calculator" class="secondary-button">
                            <span class="button-icon">🔄</span>
                            <span class="button-text">Reset</span>
                        </button>
                        <button type="button" id="debug-toggle" class="debug-button">
                            <span class="button-icon">🔧</span>
                            <span class="button-text">Debug</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Debug Panel -->
            <section id="debug-panel" class="section debug-section" style="display: none;">
                <div class="section-content">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span class="section-icon">🔧</span>
                            Debug & Testing Panel
                        </h2>
                    </div>

                    <div class="debug-tabs">
                        <button class="debug-tab active" data-tab="data">Test Data</button>
                        <button class="debug-tab" data-tab="config">Configuration</button>
                        <button class="debug-tab" data-tab="scenarios">Scenarios</button>
                        <button class="debug-tab" data-tab="export">Data Export</button>
                    </div>

                    <!-- Test Data Tab -->
                    <div class="debug-content" id="tab-data">
                        <div class="debug-group">
                            <h3>Quick Test Data</h3>
                            <div class="debug-buttons">
                                <button class="debug-btn" id="load-test-small">Small Setup</button>
                                <button class="debug-btn" id="load-test-medium">Medium Setup</button>
                                <button class="debug-btn" id="load-test-large">Large Setup</button>
                                <button class="debug-btn" id="clear-data">Clear All</button>
                            </div>
                        </div>

                        <div class="debug-group">
                            <h3>Customer Data</h3>
                            <div class="debug-inputs">
                                <input type="text" id="debug-name" placeholder="Customer Name" class="debug-input">
                                <input type="email" id="debug-email" placeholder="Customer Email" class="debug-input">
                                <input type="tel" id="debug-phone" placeholder="Customer Phone" class="debug-input">
                                <button class="debug-btn" id="apply-customer">Apply</button>
                            </div>
                        </div>
                    </div>

                    <!-- Configuration Tab -->
                    <div class="debug-content" id="tab-config" style="display: none;">
                        <div class="debug-group">
                            <h3>Webhook Configuration</h3>
                            <div class="debug-inputs">
                                <input type="url" id="webhook-url" placeholder="N8N Webhook URL" class="debug-input">
                                <input type="text" id="advisor-name" placeholder="Advisor Name" class="debug-input">
                                <input type="url" id="appointment-link" placeholder="Appointment Link" class="debug-input">
                                <button class="debug-btn" id="save-config">Save Config</button>
                            </div>
                        </div>

                        <div class="debug-group">
                            <h3>Debug Mode</h3>
                            <label class="debug-toggle">
                                <input type="checkbox" id="debug-mode"> 
                                <span class="toggle-slider"></span>
                                Enable Console Logging
                            </label>
                        </div>
                    </div>

                    <!-- Test Scenarios Tab -->
                    <div class="debug-content" id="tab-scenarios" style="display: none;">
                        <div class="debug-group">
                            <h3>Common Scenarios</h3>
                            <div class="scenario-list">
                                <div class="scenario-item">
                                    <strong>Starter Package:</strong> 10 panels, small heat pump
                                    <button class="debug-btn scenario-btn" data-scenario="starter">Load</button>
                                </div>
                                <div class="scenario-item">
                                    <strong>Family Package:</strong> 15 panels, heat pump, 10kWh battery
                                    <button class="debug-btn scenario-btn" data-scenario="family">Load</button>
                                </div>
                                <div class="scenario-item">
                                    <strong>Premium Package:</strong> 20 panels, large heat pump, 15kWh battery
                                    <button class="debug-btn scenario-btn" data-scenario="premium">Load</button>
                                </div>
                                <div class="scenario-item">
                                    <strong>Validation Test:</strong> Invalid data for error testing
                                    <button class="debug-btn scenario-btn" data-scenario="invalid">Load</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Export Tab -->
                    <div class="debug-content" id="tab-export" style="display: none;">
                        <div class="debug-group">
                            <h3>Current Data</h3>
                            <div class="debug-buttons">
                                <button class="debug-btn" id="export-json">Export JSON</button>
                                <button class="debug-btn" id="view-webhook-data">View Webhook Data</button>
                                <button class="debug-btn" id="test-calculations">Test Calculations</button>
                            </div>
                            <textarea id="debug-output" class="debug-textarea" placeholder="Debug output will appear here..." readonly></textarea>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <div class="footer-content">
                <div class="footer-text">
                    <p>© 2025 Voltera - Keurenplein 4, 1069 CD Amsterdam</p>
                    <p>+31 (0) 850 474 947 • info@voltera.nl</p>
                </div>
                <div class="footer-disclaimer">
                    <p><small>Disclaimer: Berekeningen zijn indicatief. Werkelijke opbrengst kan variëren op basis van dak, schaduw, verbruiksprofiel en tarieven.</small></p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Status Messages -->
    <div id="status-messages" class="status-messages">
        <!-- Success/error messages will be inserted here -->
    </div>

    <!-- Core JavaScript Framework - Step 3 Complete -->
    <script>
        /* ===== VOLTERA CALCULATOR CORE JAVASCRIPT ===== */
        
        // Application Configuration
        const APP_CONFIG = {
            version: '1.0.0',
            name: 'Voltera Besparingscalculator',
            debug: false,
            updateDelay: 300, // milliseconds for debounced updates
            storageKey: 'voltera_calculator_data',
            defaultWebhookUrl: 'https://altijdovernemen.app.n8n.cloud/webhook/43a55b1c-d968-48d4-a3b3-277e4d8fd60e', // Production N8N webhook
            
            // Business Rules
            calculations: {
                solar: {
                    kwhPerPanel: 400,
                    euroPerKwh: 0.30
                },
                heatPump: {
                    gasPerPerson: 80, // m³ per person for hot water
                    efficiencyFactor: 0.7, // 70% gas savings on heating
                    euroPerM3: 1.35
                },
                battery: {
                    euroPerKwhCapacity: 100,
                    fixedFeedInSavings: 256 // yearly feed-in cost savings
                }
            }
        };

        // Global Calculator State
        const CalculatorState = {
            // Customer Information
            customer: {
                name: '',
                lastname: '',
                email: '',
                agent: ''
            },
            
            // Product Data
            products: {
                solar: {
                    enabled: false,
                    inputs: {
                        panels: 0,
                        percentage: 100
                    },
                    calculations: {
                        kwhYear: 0,
                        savingsYear: 0,
                        savingsMonth: 0
                    }
                },
                heatpump: {
                    enabled: false,
                    inputs: {
                        gasUsage: 0,
                        householdSize: 0
                    },
                    calculations: {
                        heatingGas: 0,
                        savedGas: 0,
                        savingsYear: 0,
                        savingsMonth: 0
                    }
                },
                battery: {
                    enabled: false,
                    inputs: {
                        capacity: 0
                    },
                    calculations: {
                        imbalanceSavings: 0,
                        feedInSavings: 256,
                        totalSavingsYear: 0,
                        totalSavingsMonth: 0
                    }
                },
                financing: {
                    enabled: false,
                    inputs: {
                        loanAmount: 0,
                        loanTerm: 0,
                        interestRate: 4.5
                    },
                    calculations: {
                        monthlyPayment: 0,
                        totalInterest: 0,
                        totalPayment: 0,
                        netMonthlyCost: 0,
                        paybackPeriod: 0
                    }
                }
            },
            
            // Own funds and financial summary
            financialSummary: {
                ownFunds: 0,
                totalProjectCost: 0,
                financingNeed: 0,
                netBenefitMonthly: 0,
                netBenefitYearly: 0,
                paybackPeriod: 0,
                totalBenefit10Year: 0,
                roiPercentage: 0
            },
            
            // Totals
            totals: {
                year: 0,
                month: 0,
                enabledProducts: []
            },
            
            // Configuration
            config: {
                webhookUrl: '',
                advisorName: 'Voltera Adviseur',
                appointmentLink: 'https://calendly.com/voltera'
            },
            
            // UI State
            ui: {
                isCalculating: false,
                lastUpdate: null,
                validationErrors: {}
            },
            
            // Email Generation Results
            lastEmailResult: null
        };

        // Utility Functions
        const Utils = {
            // Dutch number formatting
            formatCurrency: (amount, showCents = false) => {
                if (isNaN(amount) || amount === null || amount === undefined) return '€0';
                const formatter = new Intl.NumberFormat('nl-NL', {
                    style: 'currency',
                    currency: 'EUR',
                    minimumFractionDigits: showCents ? 2 : 0,
                    maximumFractionDigits: showCents ? 2 : 0
                });
                return formatter.format(Math.round(amount));
            },

            // Format numbers with Dutch thousand separators
            formatNumber: (number, decimals = 0) => {
                if (isNaN(number) || number === null || number === undefined) return '0';
                return new Intl.NumberFormat('nl-NL', {
                    minimumFractionDigits: decimals,
                    maximumFractionDigits: decimals
                }).format(number);
            },

            // Parse Dutch formatted number back to float
            parseNumber: (str) => {
                if (!str || str === '') return 0;
                // Remove thousand separators and convert comma to dot
                const cleaned = str.toString().replace(/\./g, '').replace(',', '.');
                const num = parseFloat(cleaned);
                return isNaN(num) ? 0 : num;
            },

            // Debounce function for delayed execution
            debounce: (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            // Input validation
            validateEmail: (email) => {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            },

            validatePhone: (phone) => {
                if (!phone) return true; // Optional field
                const phoneRegex = /^[\+]?[0-9\s\-\(\)]{8,15}$/;
                return phoneRegex.test(phone);
            },

            // Generate unique ID
            generateId: () => {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            },

            // Safe DOM element selection
            getElement: (selector) => {
                const element = document.querySelector(selector);
                if (!element && APP_CONFIG.debug) {
                    console.warn(`Element not found: ${selector}`);
                }
                return element;
            },

            // Safe DOM element selection (multiple)
            getElements: (selector) => {
                return document.querySelectorAll(selector);
            },

            // Add CSS class with animation support
            addClass: (element, className) => {
                if (element) {
                    element.classList.add(className);
                }
            },

            // Remove CSS class
            removeClass: (element, className) => {
                if (element) {
                    element.classList.remove(className);
                }
            },

            // Toggle CSS class
            toggleClass: (element, className) => {
                if (element) {
                    element.classList.toggle(className);
                }
            }
        };

        // Customer Validation Engine
        const CustomerValidator = {
            // Validation patterns
            patterns: {
                name: /^[a-zA-ZÀ-ÿ\s\-']{2,50}$/,
                lastname: /^[a-zA-ZÀ-ÿ\s\-']{2,50}$/,
                email: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
                agent: /^[a-zA-ZÀ-ÿ\s\-']{2,50}$/
            },

            // Validation messages in Dutch
            messages: {
                name: {
                    required: 'Voornaam is verplicht',
                    invalid: 'Voornaam mag alleen letters, spaties en koppeltekens bevatten (2-50 karakters)',
                    valid: '✓ Voornaam ingevuld'
                },
                lastname: {
                    required: 'Achternaam is verplicht',
                    invalid: 'Achternaam mag alleen letters, spaties en koppeltekens bevatten (2-50 karakters)',
                    valid: '✓ Achternaam ingevuld'
                },
                email: {
                    required: 'Email adres is verplicht',
                    invalid: 'Voer een geldig email adres in',
                    valid: '✓ Email adres geldig'
                },
                agent: {
                    invalid: 'Agent naam mag alleen letters, spaties en koppeltekens bevatten (2-50 karakters)',
                    valid: '✓ Agent geselecteerd'
                },
                phone: {
                    invalid: 'Voer een geldig Nederlands telefoonnummer in',
                    valid: '✓ Telefoonnummer geldig'
                }
            },

            // Format Dutch phone number
            formatDutchPhone: (phone) => {
                if (!phone) return '';
                
                // Remove all non-digits
                const digits = phone.replace(/\D/g, '');
                
                // Dutch mobile numbers (06-xxxxxxxx)
                if (digits.startsWith('06') && digits.length === 10) {
                    return `${digits.slice(0, 2)}-${digits.slice(2)}`;
                }
                
                // Dutch landline numbers with area codes
                if (digits.startsWith('020') && digits.length === 10) {
                    return `020-${digits.slice(3, 6)}-${digits.slice(6)}`;
                } else if (digits.startsWith('070') && digits.length === 10) {
                    return `070-${digits.slice(3, 6)}-${digits.slice(6)}`;
                } else if (digits.startsWith('010') && digits.length === 10) {
                    return `010-${digits.slice(3, 6)}-${digits.slice(6)}`;
                }
                
                // International format starting with +31
                if (digits.startsWith('31') && digits.length >= 11) {
                    if (digits.startsWith('316')) {
                        // Mobile +31-6-xxxxxxxx
                        return `+31-6-${digits.slice(3, 11)}`;
                    } else {
                        // Landline +31-xx-xxxxxxx
                        const areaCode = digits.slice(2, 4);
                        const number = digits.slice(4);
                        return `+31-${areaCode}-${number}`;
                    }
                }
                
                return phone;
            },

            // Validate individual field
            validateField: (field, value) => {
                const result = {
                    isValid: false,
                    message: '',
                    isRequired: ['name', 'lastname', 'email'].includes(field)
                };

                // Check required fields
                if (result.isRequired && (!value || value.trim() === '')) {
                    result.message = CustomerValidator.messages[field].required;
                    return result;
                }

                // Skip validation for empty optional fields
                if (!result.isRequired && (!value || value.trim() === '')) {
                    result.isValid = true;
                    return result;
                }

                // Validate based on field type
                switch (field) {
                    case 'name':
                        result.isValid = CustomerValidator.patterns.name.test(value.trim());
                        result.message = result.isValid ? 
                            CustomerValidator.messages.name.valid : 
                            CustomerValidator.messages.name.invalid;
                        break;

                    case 'lastname':
                        result.isValid = CustomerValidator.patterns.lastname.test(value.trim());
                        result.message = result.isValid ? 
                            CustomerValidator.messages.lastname.valid : 
                            CustomerValidator.messages.lastname.invalid;
                        break;

                    case 'email':
                        result.isValid = CustomerValidator.patterns.email.test(value.trim());
                        result.message = result.isValid ? 
                            CustomerValidator.messages.email.valid : 
                            CustomerValidator.messages.email.invalid;
                        break;

                    case 'agent':
                        if (value && value.trim() && value !== '') {
                            result.isValid = CustomerValidator.patterns.agent.test(value.trim());
                            result.message = result.isValid ? 
                                CustomerValidator.messages.agent.valid : 
                                CustomerValidator.messages.agent.invalid;
                        } else {
                            result.isValid = true; // Optional field
                        }
                        break;

                    case 'phone':
                        if (value && value.trim()) {
                            result.isValid = CustomerValidator.patterns.dutchPhone.test(value.replace(/\s/g, ''));
                            result.message = result.isValid ? 
                                CustomerValidator.messages.phone.valid : 
                                CustomerValidator.messages.phone.invalid;
                        } else {
                            result.isValid = true; // Optional field
                        }
                        break;
                }

                return result;
            },

            // Show validation message
            showValidation: (field, validation) => {
                const inputElement = Utils.getElement(`#customer-${field}`);
                const errorElement = Utils.getElement(`#customer-${field}-error`);
                const successElement = Utils.getElement(`#customer-${field}-success`);

                if (!inputElement) return;

                // Clear previous states
                Utils.removeClass(inputElement, 'valid');
                Utils.removeClass(inputElement, 'invalid');
                
                if (errorElement) {
                    Utils.removeClass(errorElement, 'show');
                    errorElement.textContent = '';
                }
                
                if (successElement) {
                    Utils.removeClass(successElement, 'show');
                }

                // Apply new validation state
                if (validation.isValid && validation.message) {
                    Utils.addClass(inputElement, 'valid');
                    if (successElement) {
                        successElement.textContent = validation.message;
                        Utils.addClass(successElement, 'show');
                    }
                } else if (!validation.isValid && validation.message) {
                    Utils.addClass(inputElement, 'invalid');
                    if (errorElement) {
                        errorElement.textContent = validation.message;
                        Utils.addClass(errorElement, 'show');
                    }
                }

                // Update progress indicator
                CustomerValidator.updateProgressIndicator();
            },

            // Update customer progress indicator
            updateProgressIndicator: () => {
                const progressElement = Utils.getElement('#customer-progress');
                const progressDetailElement = Utils.getElement('#progress-detail');
                const progressIconElement = progressElement?.querySelector('.progress-icon');

                if (!progressElement) return;

                const nameValid = CustomerValidator.validateField('name', CalculatorState.customer.name).isValid;
                const lastnameValid = CustomerValidator.validateField('lastname', CalculatorState.customer.lastname).isValid;
                const emailValid = CustomerValidator.validateField('email', CalculatorState.customer.email).isValid;
                const isComplete = nameValid && lastnameValid && emailValid;

                if (isComplete) {
                    Utils.removeClass(progressElement, 'incomplete');
                    if (progressIconElement) progressIconElement.textContent = '✅';
                    if (progressDetailElement) {
                        progressDetailElement.innerHTML = '<strong>Klantgegevens compleet!</strong><br>U kunt nu een email concept genereren.';
                    }
                } else {
                    Utils.addClass(progressElement, 'incomplete');
                    if (progressIconElement) progressIconElement.textContent = '⚠️';
                    
                    const missing = [];
                    if (!nameValid) missing.push('voornaam');
                    if (!lastnameValid) missing.push('achternaam');
                    if (!emailValid) missing.push('email adres');
                    
                    if (progressDetailElement) {
                        const missingText = missing.join(' en ');
                        progressDetailElement.innerHTML = `Vul uw ${missingText} in om door te gaan.`;
                    }
                }
            },

            // Validate all customer fields
            validateAll: () => {
                const results = {
                    name: CustomerValidator.validateField('name', CalculatorState.customer.name),
                    lastname: CustomerValidator.validateField('lastname', CalculatorState.customer.lastname),
                    email: CustomerValidator.validateField('email', CalculatorState.customer.email),
                    agent: CustomerValidator.validateField('agent', CalculatorState.customer.agent)
                };

                // Show validation for all fields
                Object.keys(results).forEach(field => {
                    CustomerValidator.showValidation(field, results[field]);
                });

                return {
                    isValid: results.name.isValid && results.lastname.isValid && results.email.isValid, // Only check required fields
                    results
                };
            }
        };

        // Local Storage Management
        const StorageManager = {
            // Save calculator state to localStorage
            save: () => {
                try {
                    const dataToSave = {
                        customer: CalculatorState.customer,
                        products: CalculatorState.products,
                        financialSummary: CalculatorState.financialSummary,
                        config: CalculatorState.config,
                        timestamp: new Date().toISOString()
                    };
                    localStorage.setItem(APP_CONFIG.storageKey, JSON.stringify(dataToSave));
                    if (APP_CONFIG.debug) {
                        console.log('Calculator state saved to localStorage');
                    }
                } catch (error) {
                    console.error('Error saving to localStorage:', error);
                }
            },

            // Load calculator state from localStorage
            load: () => {
                try {
                    const saved = localStorage.getItem(APP_CONFIG.storageKey);
                    if (saved) {
                        const data = JSON.parse(saved);
                        
                        // Merge saved data with current state
                        CalculatorState.customer = { ...CalculatorState.customer, ...data.customer };
                        CalculatorState.products = { ...CalculatorState.products, ...data.products };
                        CalculatorState.financialSummary = { ...CalculatorState.financialSummary, ...data.financialSummary };
                        CalculatorState.config = { ...CalculatorState.config, ...data.config };
                        
                        if (APP_CONFIG.debug) {
                            console.log('Calculator state loaded from localStorage:', data.timestamp);
                        }
                        return true;
                    }
                } catch (error) {
                    console.error('Error loading from localStorage:', error);
                }
                return false;
            },

            // Clear saved data
            clear: () => {
                try {
                    localStorage.removeItem(APP_CONFIG.storageKey);
                    if (APP_CONFIG.debug) {
                        console.log('Calculator state cleared from localStorage');
                    }
                } catch (error) {
                    console.error('Error clearing localStorage:', error);
                }
            },

            // Check if data exists
            exists: () => {
                return localStorage.getItem(APP_CONFIG.storageKey) !== null;
            }
        };

        // Calculation Engine
        // Enhanced Validation System - Step 11
        const ValidationEngine = {
            // Input bounds and validation rules
            rules: {
                solar: {
                    panels: { min: 0, max: 50, type: 'integer', required: false },
                    percentage: { min: 1, max: 150, type: 'integer', required: false }
                },
                heatPump: {
                    gasUsage: { min: 0, max: 5000, type: 'integer', required: false },
                    householdSize: { min: 0, max: 20, type: 'integer', required: false }
                },
                battery: {
                    capacity: { min: 0, max: 50, type: 'number', required: false }
                },
                financing: {
                    loanAmount: { min: 1000, max: 100000, type: 'integer', required: false },
                    loanTerm: { min: 1, max: 30, type: 'integer', required: false },
                    interestRate: { min: 0.1, max: 15, type: 'number', required: false }
                },
                customer: {
                    name: { minLength: 2, maxLength: 50, type: 'string', required: true },
                    email: { type: 'email', required: true },
                    phone: { type: 'dutch_phone', required: false }
                }
            },

            // Validate individual input value
            validateInput: (category, field, value) => {
                try {
                    const rule = ValidationEngine.rules[category]?.[field];
                    if (!rule) {
                        return { isValid: true, message: '' };
                    }

                    // Handle empty values
                    if (!value || value === '') {
                        if (rule.required) {
                            return { isValid: false, message: 'Dit veld is verplicht' };
                        }
                        return { isValid: true, message: '' };
                    }

                    // Type validation
                    switch (rule.type) {
                        case 'integer':
                            const intValue = parseInt(value);
                            if (isNaN(intValue)) {
                                return { isValid: false, message: 'Voer een geldig getal in' };
                            }
                            if (intValue < rule.min) {
                                return { isValid: false, message: `Minimum waarde is ${rule.min}` };
                            }
                            if (intValue > rule.max) {
                                return { isValid: false, message: `Maximum waarde is ${rule.max}` };
                            }
                            return { isValid: true, message: `✓ Waarde geldig (${intValue})` };

                        case 'number':
                            const numValue = parseFloat(value);
                            if (isNaN(numValue)) {
                                return { isValid: false, message: 'Voer een geldig getal in' };
                            }
                            if (numValue < rule.min) {
                                return { isValid: false, message: `Minimum waarde is ${rule.min}` };
                            }
                            if (numValue > rule.max) {
                                return { isValid: false, message: `Maximum waarde is ${rule.max}` };
                            }
                            return { isValid: true, message: `✓ Waarde geldig (${numValue})` };

                        case 'string':
                            if (value.length < rule.minLength) {
                                return { isValid: false, message: `Minimaal ${rule.minLength} karakters` };
                            }
                            if (value.length > rule.maxLength) {
                                return { isValid: false, message: `Maximaal ${rule.maxLength} karakters` };
                            }
                            return { isValid: true, message: '✓ Naam geldig' };

                        case 'email':
                            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                            if (!emailRegex.test(value)) {
                                return { isValid: false, message: 'Ongeldig email adres' };
                            }
                            return { isValid: true, message: '✓ Email geldig' };

                        case 'dutch_phone':
                            const phoneRegex = /^(\+31|0031|0)(\d{1,3})[-\s]?(\d{3,4})[-\s]?(\d{3,4})$/;
                            if (!phoneRegex.test(value)) {
                                return { isValid: false, message: 'Ongeldig Nederlands telefoonnummer' };
                            }
                            return { isValid: true, message: '✓ Telefoonnummer geldig' };

                        default:
                            return { isValid: true, message: '' };
                    }
                } catch (error) {
                    console.error('Validation error:', error);
                    return { isValid: false, message: 'Validatiefout opgetreden' };
                }
            },

            // Sanitize and format input values
            sanitizeInput: (category, field, value) => {
                try {
                    const rule = ValidationEngine.rules[category]?.[field];
                    if (!rule || !value) return value;

                    switch (rule.type) {
                        case 'integer':
                            const intValue = parseInt(value);
                            return isNaN(intValue) ? 0 : Math.max(rule.min, Math.min(rule.max, intValue));

                        case 'number':
                            const numValue = parseFloat(value);
                            return isNaN(numValue) ? 0 : Math.max(rule.min, Math.min(rule.max, numValue));

                        case 'string':
                            return value.trim().substring(0, rule.maxLength || 100);

                        case 'email':
                            return value.trim().toLowerCase();

                        case 'dutch_phone':
                            // Format Dutch phone number
                            return value.replace(/\s/g, '').replace(/(\d{2})(\d{4})(\d{4})/, '$1-$2$3');

                        default:
                            return value;
                    }
                } catch (error) {
                    console.error('Sanitization error:', error);
                    return value;
                }
            }
        };

        const CalculationEngine = {
            // Calculate solar panel savings with enhanced error handling
            calculateSolar: (panels, percentage = 100) => {
                try {
                    const config = APP_CONFIG.calculations.solar;
                    
                    // Validate configuration
                    if (!config || typeof config.kwhPerPanel !== 'number' || typeof config.euroPerKwh !== 'number') {
                        throw new Error('Invalid solar configuration');
                    }
                    
                    // Sanitize and validate input
                    const sanitizedPanels = ValidationEngine.sanitizeInput('solar', 'panels', panels);
                    const validation = ValidationEngine.validateInput('solar', 'panels', sanitizedPanels);
                    
                    if (!validation.isValid || !sanitizedPanels || sanitizedPanels <= 0) {
                        return {
                            kwhYear: 0,
                            savingsYear: 0,
                            savingsMonth: 0,
                            error: validation.isValid ? null : validation.message
                        };
                    }
                    
                    const kwhYear = sanitizedPanels * config.kwhPerPanel * (percentage / 100);
                    const savingsYear = kwhYear * config.euroPerKwh;
                    const savingsMonth = savingsYear / 12;
                    
                    return {
                        kwhYear: Math.round(kwhYear),
                        savingsYear: Math.round(savingsYear),
                        savingsMonth: Math.round(savingsMonth),
                        error: null
                    };
                } catch (error) {
                    console.error('Solar calculation error:', error);
                    return {
                        kwhYear: 0,
                        savingsYear: 0,
                        savingsMonth: 0,
                        error: 'Berekening mislukt'
                    };
                }
            },

            // Calculate hybrid heat pump savings with enhanced error handling
            calculateHeatPump: (gasUsage, householdSize) => {
                try {
                    const config = APP_CONFIG.calculations.heatPump;
                    
                    // Validate configuration
                    if (!config || typeof config.gasPerPerson !== 'number' || typeof config.efficiencyFactor !== 'number' || typeof config.euroPerM3 !== 'number') {
                        throw new Error('Invalid heat pump configuration');
                    }
                    
                    // Sanitize and validate inputs
                    const sanitizedGasUsage = ValidationEngine.sanitizeInput('heatPump', 'gasUsage', gasUsage);
                    const sanitizedHouseholdSize = ValidationEngine.sanitizeInput('heatPump', 'householdSize', householdSize);
                    
                    const gasValidation = ValidationEngine.validateInput('heatPump', 'gasUsage', sanitizedGasUsage);
                    const sizeValidation = ValidationEngine.validateInput('heatPump', 'householdSize', sanitizedHouseholdSize);
                    
                    if (!gasValidation.isValid || !sizeValidation.isValid || !sanitizedGasUsage || sanitizedGasUsage <= 0 || !sanitizedHouseholdSize || sanitizedHouseholdSize <= 0) {
                        return {
                            heatingGas: 0,
                            savedGas: 0,
                            savingsYear: 0,
                            savingsMonth: 0,
                            error: gasValidation.isValid ? (sizeValidation.isValid ? null : sizeValidation.message) : gasValidation.message
                        };
                    }
                    
                    // Calculate gas used for heating (total - hot water per person)
                    const hotWaterGas = sanitizedHouseholdSize * config.gasPerPerson;
                    const heatingGas = Math.max(0, sanitizedGasUsage - hotWaterGas);
                    
                    // Calculate gas savings (70% efficiency on heating portion)
                    const savedGas = heatingGas * config.efficiencyFactor;
                    
                    // Calculate euro savings
                    const savingsYear = savedGas * config.euroPerM3;
                    const savingsMonth = savingsYear / 12;
                    
                    return {
                        heatingGas: Math.round(heatingGas),
                        savedGas: Math.round(savedGas),
                        savingsYear: Math.round(savingsYear),
                        savingsMonth: Math.round(savingsMonth),
                        error: null
                    };
                } catch (error) {
                    console.error('Heat pump calculation error:', error);
                    return {
                        heatingGas: 0,
                        savedGas: 0,
                        savingsYear: 0,
                        savingsMonth: 0,
                        error: 'Berekening mislukt'
                    };
                }
            },

            // Calculate battery savings with enhanced error handling
            calculateBattery: (capacity) => {
                try {
                    const config = APP_CONFIG.calculations.battery;
                    
                    // Validate configuration
                    if (!config || typeof config.euroPerKwhCapacity !== 'number' || typeof config.fixedFeedInSavings !== 'number') {
                        throw new Error('Invalid battery configuration');
                    }
                    
                    // Sanitize and validate input
                    const sanitizedCapacity = ValidationEngine.sanitizeInput('battery', 'capacity', capacity);
                    const validation = ValidationEngine.validateInput('battery', 'capacity', sanitizedCapacity);
                    
                    if (!validation.isValid || !sanitizedCapacity || sanitizedCapacity <= 0) {
                        return {
                            imbalanceSavings: 0,
                            feedInSavings: 0,
                            totalSavingsYear: 0,
                            totalSavingsMonth: 0,
                            error: validation.isValid ? null : validation.message
                        };
                    }
                    
                    const imbalanceSavings = sanitizedCapacity * config.euroPerKwhCapacity;
                    const feedInSavings = config.fixedFeedInSavings;
                    const totalSavingsYear = imbalanceSavings + feedInSavings;
                    const totalSavingsMonth = totalSavingsYear / 12;
                    
                    return {
                        imbalanceSavings: Math.round(imbalanceSavings),
                        feedInSavings: Math.round(feedInSavings),
                        totalSavingsYear: Math.round(totalSavingsYear),
                        totalSavingsMonth: Math.round(totalSavingsMonth),
                        error: null
                    };
                } catch (error) {
                    console.error('Battery calculation error:', error);
                    return {
                        imbalanceSavings: 0,
                        feedInSavings: 0,
                        totalSavingsYear: 0,
                        totalSavingsMonth: 0,
                        error: 'Berekening mislukt'
                    };
                }
            },

            // Calculate financing with loan payments and net costs
            calculateFinancing: (loanAmount, loanTerm, interestRate, monthlySavings) => {
                try {
                    // Validate inputs
                    if (!loanAmount || loanAmount <= 0 || !loanTerm || loanTerm <= 0 || !interestRate || interestRate < 0) {
                        return {
                            monthlyPayment: 0,
                            totalInterest: 0,
                            totalPayment: 0,
                            netMonthlyCost: 0,
                            paybackPeriod: 0,
                            error: null
                        };
                    }

                    // Convert annual rate to monthly rate
                    const monthlyRate = (interestRate / 100) / 12;
                    const totalMonths = loanTerm * 12;
                    
                    // Calculate monthly payment using annuity formula
                    // PMT = P * [r(1+r)^n] / [(1+r)^n - 1]
                    let monthlyPayment;
                    if (monthlyRate === 0) {
                        // If no interest, simple division
                        monthlyPayment = loanAmount / totalMonths;
                    } else {
                        const compound = Math.pow(1 + monthlyRate, totalMonths);
                        monthlyPayment = loanAmount * (monthlyRate * compound) / (compound - 1);
                    }
                    
                    const totalPayment = monthlyPayment * totalMonths;
                    const totalInterest = totalPayment - loanAmount;
                    const netMonthlyCost = monthlyPayment - (monthlySavings || 0);
                    
                    // Calculate payback period (when net monthly cost becomes positive)
                    let paybackPeriod = 0;
                    if (monthlySavings > 0) {
                        paybackPeriod = loanAmount / (monthlySavings * 12);
                    }
                    
                    return {
                        monthlyPayment: Math.round(monthlyPayment * 100) / 100,
                        totalInterest: Math.round(totalInterest),
                        totalPayment: Math.round(totalPayment),
                        netMonthlyCost: Math.round(netMonthlyCost * 100) / 100,
                        paybackPeriod: Math.round(paybackPeriod * 10) / 10,
                        error: null
                    };
                } catch (error) {
                    console.error('Financing calculation error:', error);
                    return {
                        monthlyPayment: 0,
                        totalInterest: 0,
                        totalPayment: 0,
                        netMonthlyCost: 0,
                        paybackPeriod: 0,
                        error: 'Berekening mislukt'
                    };
                }
            },

            // Calculate total savings across all enabled products with enhanced error handling
            calculateTotals: () => {
                try {
                    let totalYear = 0;
                    let totalMonth = 0;
                    const enabledProducts = [];
                    const errors = [];
                    
                    // Validate calculator state
                    if (!CalculatorState.products || typeof CalculatorState.products !== 'object') {
                        throw new Error('Invalid calculator state');
                    }
                    
                    // Add enabled product savings
                    Object.keys(CalculatorState.products).forEach(productKey => {
                        try {
                            const product = CalculatorState.products[productKey];
                            if (product && product.enabled && product.calculations) {
                                const yearSavings = product.calculations.savingsYear || product.calculations.totalSavingsYear || 0;
                                const monthSavings = product.calculations.savingsMonth || product.calculations.totalSavingsMonth || 0;
                                
                                // Validate that savings are numbers
                                if (typeof yearSavings === 'number' && !isNaN(yearSavings)) {
                                    totalYear += yearSavings;
                                }
                                if (typeof monthSavings === 'number' && !isNaN(monthSavings)) {
                                    totalMonth += monthSavings;
                                }
                                
                                enabledProducts.push(productKey);
                                
                                // Track calculation errors from individual products
                                if (product.calculations.error) {
                                    errors.push(`${productKey}: ${product.calculations.error}`);
                                }
                            }
                        } catch (productError) {
                            console.error(`Error calculating totals for ${productKey}:`, productError);
                            errors.push(`${productKey}: Berekeningsfout`);
                        }
                    });
                    
                    return {
                        year: Math.round(totalYear),
                        month: Math.round(totalMonth),
                        enabledProducts,
                        errors: errors.length > 0 ? errors : null
                    };
                } catch (error) {
                    console.error('Total calculation error:', error);
                    return {
                        year: 0,
                        month: 0,
                        enabledProducts: [],
                        errors: ['Totaalberekening mislukt']
                    };
                }
            },
            
            // Calculate financial summary with own funds
            calculateFinancialSummary: (ownFunds = 0) => {
                const products = CalculatorState.products;
                const totals = CalculatorState.totals;
                
                // Define product cost estimates (these would normally come from config)
                const productCosts = {
                    solar: { costPerPanel: 1500 }, // €1,500 per panel
                    heatpump: { baseCost: 8000 }, // €8,000 base cost
                    battery: { costPerKwh: 1200 } // €1,200 per kWh
                };
                
                try {
                    // Calculate total project cost (estimated costs for enabled products)
                    let totalProjectCost = 0;
                    
                    if (products.solar.enabled) {
                        const panels = products.solar.inputs.panels || 0;
                        totalProjectCost += panels * productCosts.solar.costPerPanel;
                    }
                    
                    if (products.heatpump.enabled) {
                        totalProjectCost += productCosts.heatpump.baseCost;
                    }
                    
                    if (products.battery.enabled) {
                        const capacity = products.battery.inputs.capacity || 0;
                        totalProjectCost += capacity * productCosts.battery.costPerKwh;
                    }
                    
                    // Calculate financing need
                    const sanitizedOwnFunds = Math.max(0, Math.min(ownFunds, totalProjectCost));
                    const financingNeed = Math.max(0, totalProjectCost - sanitizedOwnFunds);
                    
                    // Calculate net benefit (total savings minus financing costs)
                    let netBenefitMonthly = totals.month;
                    let netBenefitYearly = totals.year;
                    
                    // If financing is enabled, subtract the financing costs
                    if (products.financing.enabled && products.financing.calculations.monthlyPayment > 0) {
                        netBenefitMonthly = Math.max(0, totals.month - products.financing.calculations.monthlyPayment);
                        netBenefitYearly = netBenefitMonthly * 12;
                    }
                    
                    // Calculate payback period
                    let paybackPeriod = 0;
                    if (netBenefitYearly > 0 && (totalProjectCost - sanitizedOwnFunds) > 0) {
                        paybackPeriod = (totalProjectCost - sanitizedOwnFunds) / netBenefitYearly;
                    }
                    
                    // Calculate 10-year total benefit
                    const totalBenefit10Year = netBenefitYearly * 10;
                    
                    // Calculate ROI percentage
                    let roiPercentage = 0;
                    if (totalProjectCost > 0) {
                        roiPercentage = (totalBenefit10Year / totalProjectCost) * 100;
                    }
                    
                    return {
                        ownFunds: sanitizedOwnFunds,
                        totalProjectCost,
                        financingNeed,
                        netBenefitMonthly,
                        netBenefitYearly,
                        paybackPeriod,
                        totalBenefit10Year,
                        roiPercentage,
                        error: null
                    };
                    
                } catch (error) {
                    console.error('Financial summary calculation error:', error);
                    return {
                        ownFunds: 0,
                        totalProjectCost: 0,
                        financingNeed: 0,
                        netBenefitMonthly: 0,
                        netBenefitYearly: 0,
                        paybackPeriod: 0,
                        totalBenefit10Year: 0,
                        roiPercentage: 0,
                        error: error.message
                    };
                }
            },

            // Update all calculations
            updateAllCalculations: () => {
                const products = CalculatorState.products;
                
                // Calculate solar savings
                if (products.solar.enabled || products.solar.inputs.panels > 0) {
                    products.solar.calculations = CalculationEngine.calculateSolar(
                        products.solar.inputs.panels,
                        products.solar.inputs.percentage
                    );
                }
                
                // Calculate heat pump savings
                if (products.heatpump.enabled || (products.heatpump.inputs.gasUsage > 0 && products.heatpump.inputs.householdSize > 0)) {
                    products.heatpump.calculations = CalculationEngine.calculateHeatPump(
                        products.heatpump.inputs.gasUsage,
                        products.heatpump.inputs.householdSize
                    );
                }
                
                // Calculate battery savings
                if (products.battery.enabled || products.battery.inputs.capacity > 0) {
                    products.battery.calculations = CalculationEngine.calculateBattery(
                        products.battery.inputs.capacity
                    );
                }
                
                // Calculate financing costs
                if (products.financing.enabled && products.financing.inputs.loanAmount > 0) {
                    const totalMonthlySavings = 
                        (products.solar.calculations?.savingsMonth || 0) +
                        (products.heatpump.calculations?.savingsMonth || 0) +
                        (products.battery.calculations?.totalSavingsMonth || 0);
                        
                    products.financing.calculations = CalculationEngine.calculateFinancing(
                        products.financing.inputs.loanAmount,
                        products.financing.inputs.loanTerm,
                        products.financing.inputs.interestRate,
                        totalMonthlySavings
                    );
                }
                
                // Calculate totals
                CalculatorState.totals = CalculationEngine.calculateTotals();
                
                // Calculate financial summary with current own funds
                CalculatorState.financialSummary = CalculationEngine.calculateFinancialSummary(
                    CalculatorState.financialSummary.ownFunds
                );
                
                if (APP_CONFIG.debug) {
                    console.log('Calculations updated:', CalculatorState.totals);
                    console.log('Financial summary updated:', CalculatorState.financialSummary);
                }
            }
        };

        // UI Update Engine
        const UIUpdater = {
            // Update solar panel display
            updateSolarDisplay: () => {
                const calc = CalculatorState.products.solar.calculations;
                const enabled = CalculatorState.products.solar.enabled;
                
                // Update calculation display
                const kwhElement = Utils.getElement('#solar-kwh');
                const savingsElement = Utils.getElement('#solar-savings');
                const previewElement = Utils.getElement('#solar-savings-preview');
                
                if (kwhElement) {
                    kwhElement.textContent = Utils.formatNumber(calc.kwhYear) + ' kWh';
                }
                
                if (savingsElement) {
                    savingsElement.textContent = `${Utils.formatCurrency(calc.savingsMonth)}/maand (${Utils.formatCurrency(calc.savingsYear)}/jaar)`;
                }
                
                if (previewElement) {
                    previewElement.textContent = Utils.formatCurrency(calc.savingsMonth) + '/maand';
                }
                
                // Add pulse animation
                UIUpdater.addPulseAnimation([kwhElement, savingsElement, previewElement]);
            },

            // Update heat pump display
            updateHeatPumpDisplay: () => {
                const calc = CalculatorState.products.heatpump.calculations;
                const enabled = CalculatorState.products.heatpump.enabled;
                
                // Update calculation display
                const heatingGasElement = Utils.getElement('#heatpump-heating-gas');
                const savedGasElement = Utils.getElement('#heatpump-saved-gas');
                const savingsElement = Utils.getElement('#heatpump-savings');
                const previewElement = Utils.getElement('#heatpump-savings-preview');
                
                if (heatingGasElement) {
                    heatingGasElement.textContent = Utils.formatNumber(calc.heatingGas) + ' m³';
                }
                
                if (savedGasElement) {
                    savedGasElement.textContent = Utils.formatNumber(calc.savedGas) + ' m³ (70%)';
                }
                
                if (savingsElement) {
                    savingsElement.textContent = `${Utils.formatCurrency(calc.savingsMonth)}/maand (${Utils.formatCurrency(calc.savingsYear)}/jaar)`;
                }
                
                if (previewElement) {
                    previewElement.textContent = Utils.formatCurrency(calc.savingsMonth) + '/maand';
                }
                
                // Add pulse animation
                UIUpdater.addPulseAnimation([heatingGasElement, savedGasElement, savingsElement, previewElement]);
            },

            // Update battery display
            updateBatteryDisplay: () => {
                const calc = CalculatorState.products.battery.calculations;
                const enabled = CalculatorState.products.battery.enabled;
                
                // Update calculation display
                const imbalanceElement = Utils.getElement('#battery-imbalance');
                const feedinElement = Utils.getElement('#battery-feedin');
                const savingsElement = Utils.getElement('#battery-savings');
                const previewElement = Utils.getElement('#battery-savings-preview');
                
                if (imbalanceElement) {
                    imbalanceElement.textContent = Utils.formatCurrency(calc.imbalanceSavings) + '/jaar';
                }
                
                if (feedinElement) {
                    feedinElement.textContent = Utils.formatCurrency(calc.feedInSavings) + '/jaar';
                }
                
                if (savingsElement) {
                    savingsElement.textContent = `${Utils.formatCurrency(calc.totalSavingsMonth)}/maand (${Utils.formatCurrency(calc.totalSavingsYear)}/jaar)`;
                }
                
                if (previewElement) {
                    previewElement.textContent = Utils.formatCurrency(calc.totalSavingsMonth) + '/maand';
                }
                
                // Add pulse animation
                UIUpdater.addPulseAnimation([imbalanceElement, feedinElement, savingsElement, previewElement]);
            },

            // Update financing display
            updateFinancingDisplay: () => {
                const calc = CalculatorState.products.financing.calculations;
                
                const monthlyPaymentElement = Utils.getElement('#monthly-payment');
                const totalInterestElement = Utils.getElement('#total-interest');
                const totalPaymentElement = Utils.getElement('#total-payment');
                const netMonthlyCostElement = Utils.getElement('#net-monthly-cost');
                const paybackPeriodElement = Utils.getElement('#payback-period');
                const previewElement = Utils.getElement('#financing-preview');
                
                if (monthlyPaymentElement) {
                    monthlyPaymentElement.textContent = Utils.formatCurrency(calc.monthlyPayment);
                }
                
                if (totalInterestElement) {
                    totalInterestElement.textContent = Utils.formatCurrency(calc.totalInterest);
                }
                
                if (totalPaymentElement) {
                    totalPaymentElement.textContent = Utils.formatCurrency(calc.totalPayment);
                }
                
                if (netMonthlyCostElement) {
                    const netCost = calc.netMonthlyCost;
                    if (netCost <= 0) {
                        netMonthlyCostElement.textContent = `€0/maand (direct voordeel: ${Utils.formatCurrency(Math.abs(netCost))}/maand)`;
                        netMonthlyCostElement.style.color = 'var(--color-success)';
                    } else {
                        netMonthlyCostElement.textContent = `${Utils.formatCurrency(netCost)}/maand`;
                        netMonthlyCostElement.style.color = '';
                    }
                }
                
                if (paybackPeriodElement) {
                    if (calc.paybackPeriod > 0) {
                        paybackPeriodElement.textContent = `${calc.paybackPeriod} jaar`;
                    } else {
                        paybackPeriodElement.textContent = 'Direct rendabel';
                    }
                }
                
                if (previewElement) {
                    if (calc.monthlyPayment > 0) {
                        previewElement.textContent = `${Utils.formatCurrency(calc.monthlyPayment)}/maand`;
                    } else {
                        previewElement.textContent = 'Bereken maandlasten';
                    }
                }
                
                // Add pulse animation
                UIUpdater.addPulseAnimation([monthlyPaymentElement, totalInterestElement, totalPaymentElement, netMonthlyCostElement, paybackPeriodElement, previewElement]);
            },

            // Update total display (header and actions section)
            updateTotalDisplay: () => {
                const totals = CalculatorState.totals;
                
                // Update header total display
                const headerAmountElement = Utils.getElement('.total-amount');
                const headerYearlyElement = Utils.getElement('.total-yearly');
                
                if (headerAmountElement) {
                    headerAmountElement.textContent = Utils.formatCurrency(totals.month);
                }
                
                if (headerYearlyElement) {
                    headerYearlyElement.textContent = `(${Utils.formatCurrency(totals.year)}/jaar)`;
                }
                
                // Update actions section total
                const finalTotalYearElement = Utils.getElement('#final-total-year');
                const finalTotalMonthElement = Utils.getElement('#final-total-month');
                
                if (finalTotalMonthElement) {
                    finalTotalMonthElement.textContent = Utils.formatCurrency(totals.month) + ' per maand';
                }
                
                if (finalTotalYearElement) {
                    finalTotalYearElement.textContent = `(${Utils.formatCurrency(totals.year)} per jaar)`;
                }
                
                // Update email button state
                const emailButton = Utils.getElement('#generate-email');
                const hasValidData = totals.year > 0 && 
                                   CalculatorState.customer.name && 
                                   CalculatorState.customer.email;
                
                if (emailButton) {
                    emailButton.disabled = !hasValidData;
                }
                
                // Add pulse animation to totals
                // Use strong animation for total updates (more prominent)
                UIUpdater.addPulseAnimation([
                    headerAmountElement, 
                    headerYearlyElement
                ], true);
                
                // Regular animation for summary section
                UIUpdater.addPulseAnimation([
                    finalTotalYearElement, 
                    finalTotalMonthElement
                ]);
            },
            
            // Update financial summary display
            updateFinancialSummaryDisplay: () => {
                const summary = CalculatorState.financialSummary;
                
                // Update own funds display
                const ownFundsDisplayElement = Utils.getElement('#own-funds-display');
                if (ownFundsDisplayElement) {
                    ownFundsDisplayElement.textContent = Utils.formatCurrency(summary.ownFunds);
                }
                
                // Update total project cost
                const totalProjectCostElement = Utils.getElement('#total-project-cost');
                if (totalProjectCostElement) {
                    totalProjectCostElement.textContent = Utils.formatCurrency(summary.totalProjectCost);
                }
                
                // Update financing need
                const financingNeedElement = Utils.getElement('#financing-need');
                if (financingNeedElement) {
                    financingNeedElement.textContent = Utils.formatCurrency(summary.financingNeed);
                }
                
                // Update net benefit
                const netBenefitMonthlyElement = Utils.getElement('#net-benefit-monthly');
                const netBenefitYearlyElement = Utils.getElement('#net-benefit-yearly');
                if (netBenefitMonthlyElement) {
                    netBenefitMonthlyElement.textContent = `${Utils.formatCurrency(summary.netBenefitMonthly)}/maand`;
                }
                if (netBenefitYearlyElement) {
                    netBenefitYearlyElement.textContent = `(${Utils.formatCurrency(summary.netBenefitYearly)}/jaar)`;
                }
                
                // Update payback period
                const paybackPeriodElement = Utils.getElement('#payback-period');
                if (paybackPeriodElement) {
                    if (summary.paybackPeriod > 0 && summary.paybackPeriod < 100) {
                        paybackPeriodElement.textContent = `${summary.paybackPeriod.toFixed(1)} jaar`;
                    } else {
                        paybackPeriodElement.textContent = 'Direct rendabel';
                    }
                }
                
                // Update 10-year benefit
                const totalBenefit10YElement = Utils.getElement('#total-benefit-10y');
                if (totalBenefit10YElement) {
                    totalBenefit10YElement.textContent = Utils.formatCurrency(summary.totalBenefit10Year);
                }
                
                // Update ROI percentage
                const roiPercentageElement = Utils.getElement('#roi-percentage');
                if (roiPercentageElement) {
                    roiPercentageElement.textContent = `${summary.roiPercentage.toFixed(1)}%`;
                }
                
                // Add pulse animation to all elements
                const animationElements = [
                    ownFundsDisplayElement,
                    totalProjectCostElement,
                    financingNeedElement,
                    netBenefitMonthlyElement,
                    netBenefitYearlyElement,
                    paybackPeriodElement,
                    totalBenefit10YElement,
                    roiPercentageElement
                ];
                UIUpdater.addPulseAnimation(animationElements);
            },

            // Update all displays
            updateAllDisplays: () => {
                UIUpdater.updateSolarDisplay();
                UIUpdater.updateHeatPumpDisplay();
                UIUpdater.updateBatteryDisplay();
                UIUpdater.updateFinancingDisplay();
                UIUpdater.updateFinancialSummaryDisplay();
                UIUpdater.updateTotalDisplay();
            },

            // Add pulse animation to elements
            addPulseAnimation: (elements, strong = false) => {
                const animationClass = strong ? 'value-updated-strong' : 'value-updated';
                
                elements.forEach(element => {
                    if (element) {
                        // Remove existing animation classes
                        Utils.removeClass(element, 'value-updated');
                        Utils.removeClass(element, 'value-updated-strong');
                        Utils.removeClass(element, 'calculating');
                        
                        // Force reflow to restart animation
                        void element.offsetWidth;
                        
                        // Add appropriate animation class
                        Utils.addClass(element, animationClass);
                        
                        // Remove class after animation completes
                        setTimeout(() => {
                            Utils.removeClass(element, animationClass);
                        }, strong ? 800 : 500);
                    }
                });
            },

            // Show calculating state with shimmer effect
            showCalculating: (elements) => {
                elements.forEach(element => {
                    if (element) {
                        Utils.addClass(element, 'calculating');
                    }
                });
            },

            // Hide calculating state
            hideCalculating: (elements) => {
                elements.forEach(element => {
                    if (element) {
                        Utils.removeClass(element, 'calculating');
                    }
                });
            },

            // Update UI from saved state (for page load)
            restoreUIFromState: () => {
                // Restore customer inputs
                const nameInput = Utils.getElement('#customer-name');
                const lastnameInput = Utils.getElement('#customer-lastname');
                const emailInput = Utils.getElement('#customer-email');
                const agentSelect = Utils.getElement('#agent-name-select');
                const agentCustom = Utils.getElement('#agent-name-custom');
                
                if (nameInput) nameInput.value = CalculatorState.customer.name || '';
                if (lastnameInput) lastnameInput.value = CalculatorState.customer.lastname || '';
                if (emailInput) emailInput.value = CalculatorState.customer.email || '';
                
                // Restore agent selection
                if (agentSelect && CalculatorState.customer.agent) {
                    const agent = CalculatorState.customer.agent;
                    const option = Array.from(agentSelect.options).find(opt => opt.value === agent);
                    if (option) {
                        agentSelect.value = agent;
                    } else {
                        agentSelect.value = 'custom';
                        if (agentCustom) {
                            agentCustom.value = agent;
                            agentCustom.style.display = 'block';
                        }
                    }
                }
                
                // Trigger customer validation after restoration
                CustomerValidator.validateAll();
                
                // Restore product inputs and checkboxes
                const solarPanelsInput = Utils.getElement('#solar-panels');
                const solarPercentageInput = Utils.getElement('#solar-percentage');
                const solarCheckbox = Utils.getElement('#solar-enabled');
                const gasUsageInput = Utils.getElement('#gas-usage');
                const householdSizeInput = Utils.getElement('#household-size');
                const heatpumpCheckbox = Utils.getElement('#heatpump-enabled');
                const batteryCapacityInput = Utils.getElement('#battery-capacity');
                const batteryCheckbox = Utils.getElement('#battery-enabled');
                
                if (solarPanelsInput) solarPanelsInput.value = CalculatorState.products.solar.inputs.panels || '';
                if (solarPercentageInput) solarPercentageInput.value = CalculatorState.products.solar.inputs.percentage || 100;
                if (solarCheckbox) solarCheckbox.checked = CalculatorState.products.solar.enabled || false;
                
                if (gasUsageInput) gasUsageInput.value = CalculatorState.products.heatpump.inputs.gasUsage || '';
                if (householdSizeInput) householdSizeInput.value = CalculatorState.products.heatpump.inputs.householdSize || '';
                if (heatpumpCheckbox) heatpumpCheckbox.checked = CalculatorState.products.heatpump.enabled || false;
                
                if (batteryCapacityInput) batteryCapacityInput.value = CalculatorState.products.battery.inputs.capacity || '';
                if (batteryCheckbox) batteryCheckbox.checked = CalculatorState.products.battery.enabled || false;
                
                // Restore financing inputs
                const loanAmountInput = Utils.getElement('#loan-amount');
                const loanTermSelect = Utils.getElement('#loan-term');
                const interestRateInput = Utils.getElement('#interest-rate');
                const financingCheckbox = Utils.getElement('#financing-enabled');
                
                if (loanAmountInput) loanAmountInput.value = CalculatorState.products.financing.inputs.loanAmount || '';
                if (loanTermSelect) loanTermSelect.value = CalculatorState.products.financing.inputs.loanTerm || '';
                if (interestRateInput) interestRateInput.value = CalculatorState.products.financing.inputs.interestRate || 4.5;
                if (financingCheckbox) financingCheckbox.checked = CalculatorState.products.financing.enabled || false;
                
                // Update section enabled states
                const solarSection = Utils.getElement('#solar-section');
                const heatpumpSection = Utils.getElement('#heatpump-section');
                const batterySection = Utils.getElement('#battery-section');
                const financingSection = Utils.getElement('#financing-section');
                
                if (solarSection && CalculatorState.products.solar.enabled) {
                    Utils.addClass(solarSection, 'enabled');
                }
                if (heatpumpSection && CalculatorState.products.heatpump.enabled) {
                    Utils.addClass(heatpumpSection, 'enabled');
                }
                if (batterySection && CalculatorState.products.battery.enabled) {
                    Utils.addClass(batterySection, 'enabled');
                }
                if (financingSection && CalculatorState.products.financing.enabled) {
                    Utils.addClass(financingSection, 'enabled');
                }
                
                // Update configuration panel if in debug mode
                if (APP_CONFIG.debug) {
                    const webhookUrlInput = Utils.getElement('#webhook-url');
                    const advisorNameInput = Utils.getElement('#advisor-name');
                    const appointmentLinkInput = Utils.getElement('#appointment-link');
                    
                    if (webhookUrlInput) webhookUrlInput.value = CalculatorState.config.webhookUrl || '';
                    if (advisorNameInput) advisorNameInput.value = CalculatorState.config.advisorName || '';
                    if (appointmentLinkInput) appointmentLinkInput.value = CalculatorState.config.appointmentLink || '';
                }
                
                // Perform initial calculations and display update
                CalculationEngine.updateAllCalculations();
                UIUpdater.updateAllDisplays();
            }
        };

        // Email Generation Engine
        const EmailGenerator = {
            // Prepare comprehensive email data for N8N webhook
            prepareEmailData: () => {
                const customer = CalculatorState.customer;
                const products = CalculatorState.products;
                const totals = CalculatorState.totals;
                const config = CalculatorState.config;

                // Calculate enabled products with details
                const enabledProducts = [];
                
                if (products.solar.enabled && products.solar.calculations.savingsYear > 0) {
                    enabledProducts.push({
                        type: 'solar',
                        name: 'Zonnepanelen',
                        emoji: '☀️',
                        details: {
                            panels: products.solar.inputs.panels,
                            percentage: products.solar.inputs.percentage,
                            kwhPerYear: products.solar.calculations.kwhYear,
                            savingsPerYear: products.solar.calculations.savingsYear,
                            savingsPerMonth: products.solar.calculations.savingsMonth
                        },
                        summary: `${products.solar.inputs.panels} zonnepanelen genereren ${Utils.formatNumber(products.solar.calculations.kwhYear)} kWh per jaar`
                    });
                }
                
                if (products.heatpump.enabled && products.heatpump.calculations.savingsYear > 0) {
                    enabledProducts.push({
                        type: 'heatpump',
                        name: 'Hybride Warmtepomp',
                        emoji: '🔥',
                        details: {
                            gasUsage: products.heatpump.inputs.gasUsage,
                            householdSize: products.heatpump.inputs.householdSize,
                            heatingGas: products.heatpump.calculations.heatingGas,
                            savedGas: products.heatpump.calculations.savedGas,
                            savingsPerYear: products.heatpump.calculations.savingsYear,
                            savingsPerMonth: products.heatpump.calculations.savingsMonth
                        },
                        summary: `Hybride warmtepomp bespaart ${Utils.formatNumber(products.heatpump.calculations.savedGas)} m³ gas per jaar (70%)`
                    });
                }
                
                if (products.battery.enabled && products.battery.calculations.totalSavingsYear > 0) {
                    enabledProducts.push({
                        type: 'battery',
                        name: 'Thuisbatterij',
                        emoji: '🔋',
                        details: {
                            capacity: products.battery.inputs.capacity,
                            imbalanceSavings: products.battery.calculations.imbalanceSavings,
                            feedInSavings: products.battery.calculations.feedInSavings,
                            totalSavingsPerYear: products.battery.calculations.totalSavingsYear,
                            totalSavingsPerMonth: products.battery.calculations.totalSavingsMonth
                        },
                        summary: `${products.battery.inputs.capacity} kWh thuisbatterij voor onbalanshandel en terugleverkosten`
                    });
                }

                // Generate natural language summary
                const productNames = enabledProducts.map(p => p.name).join(', ');
                const lastComma = productNames.lastIndexOf(',');
                const naturalSummary = lastComma > -1 
                    ? productNames.substring(0, lastComma) + ' en' + productNames.substring(lastComma + 1)
                    : productNames;

                return {
                    // Email metadata
                    timestamp: new Date().toISOString(),
                    calculatorVersion: APP_CONFIG.version,
                    
                    // Customer information
                    customer: {
                        name: customer.name,
                        email: customer.email,
                        phone: customer.phone || null
                    },
                    
                    // Advisor information  
                    advisor: {
                        name: config.advisorName || 'Voltera Adviseur',
                        company: 'Voltera',
                        phone: '+31 (0) 850 474 947',
                        email: 'info@voltera.nl',
                        appointmentLink: config.appointmentLink || 'https://calendly.com/voltera'
                    },
                    
                    // Calculation summary
                    summary: {
                        totalSavingsPerYear: totals.year,
                        totalSavingsPerMonth: totals.month,
                        productCount: enabledProducts.length,
                        naturalLanguageSummary: naturalSummary,
                        formattedSavings: {
                            year: Utils.formatCurrency(totals.year),
                            month: Utils.formatCurrency(totals.month)
                        }
                    },
                    
                    // Detailed product information
                    products: enabledProducts,
                    
                    // Email template suggestions
                    emailSuggestions: {
                        subject: `Energiebesparing berekening voor ${customer.name} - ${Utils.formatCurrency(totals.year)} per jaar`,
                        greeting: `Beste ${customer.name},`,
                        introduction: `Bedankt voor uw interesse in duurzame energieoplossingen! Hieronder vindt u de berekening van uw mogelijke energiebesparing met ${naturalSummary}.`,
                        callToAction: `Wilt u meer weten over deze oplossingen? Plan dan een vrijblijvend gesprek met onze energieadviseur.`,
                        closingLine: `Met vriendelijke groet,\n${config.advisorName || 'Het Voltera Team'}`
                    },
                    
                    // Technical details for N8N processing
                    meta: {
                        source: 'voltera-calculator',
                        userAgent: navigator.userAgent,
                        language: 'nl-NL',
                        currency: 'EUR'
                    }
                };
            }
        };

        // Debug Panel System - Step 10
        const DebugPanel = {
            isOpen: false,
            activeTab: 'data',

            // Initialize debug panel
            init: () => {
                DebugPanel.setupTabListeners();
                DebugPanel.setupDebugListeners();
                DebugPanel.loadConfigFromState();
            },

            // Toggle debug panel visibility
            toggle: () => {
                const panel = Utils.getElement('#debug-panel');
                if (panel) {
                    DebugPanel.isOpen = !DebugPanel.isOpen;
                    panel.style.display = DebugPanel.isOpen ? 'block' : 'none';
                    
                    if (DebugPanel.isOpen) {
                        panel.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            },

            // Setup tab switching
            setupTabListeners: () => {
                const tabs = document.querySelectorAll('.debug-tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabName = e.target.dataset.tab;
                        DebugPanel.switchTab(tabName);
                    });
                });
            },

            // Switch between debug tabs
            switchTab: (tabName) => {
                // Update tab appearance
                document.querySelectorAll('.debug-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                // Show/hide content
                document.querySelectorAll('.debug-content').forEach(content => {
                    content.style.display = 'none';
                });
                Utils.getElement(`#tab-${tabName}`).style.display = 'block';

                DebugPanel.activeTab = tabName;
            },

            // Setup all debug button listeners
            setupDebugListeners: () => {
                // Test data buttons
                Utils.getElement('#load-test-small')?.addEventListener('click', () => DebugPanel.loadTestData('small'));
                Utils.getElement('#load-test-medium')?.addEventListener('click', () => DebugPanel.loadTestData('medium'));
                Utils.getElement('#load-test-large')?.addEventListener('click', () => DebugPanel.loadTestData('large'));
                Utils.getElement('#clear-data')?.addEventListener('click', DebugPanel.clearAllData);

                // Customer data
                Utils.getElement('#apply-customer')?.addEventListener('click', DebugPanel.applyCustomerData);

                // Configuration
                Utils.getElement('#save-config')?.addEventListener('click', DebugPanel.saveConfiguration);
                Utils.getElement('#debug-mode')?.addEventListener('change', DebugPanel.toggleDebugMode);

                // Scenarios
                document.querySelectorAll('.scenario-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const scenario = e.target.dataset.scenario;
                        DebugPanel.loadScenario(scenario);
                    });
                });

                // Export functions
                Utils.getElement('#export-json')?.addEventListener('click', DebugPanel.exportData);
                Utils.getElement('#view-webhook-data')?.addEventListener('click', DebugPanel.viewWebhookData);
                Utils.getElement('#test-calculations')?.addEventListener('click', DebugPanel.testCalculations);
            },

            // Load predefined test data sets
            loadTestData: (size) => {
                let testData;
                
                switch (size) {
                    case 'small':
                        testData = {
                            customer: { name: 'Piet Janssen', email: 'piet@example.com', phone: '06-11111111' },
                            products: {
                                solar: { enabled: true, inputs: { panels: 8, percentage: 100 } },
                                heatpump: { enabled: false, inputs: { gasUsage: 0, householdSize: 0 } },
                                battery: { enabled: false, inputs: { capacity: 0 } }
                            }
                        };
                        break;
                    case 'medium':
                        testData = {
                            customer: { name: 'Maria de Vries', email: 'maria@example.com', phone: '06-22222222' },
                            products: {
                                solar: { enabled: true, inputs: { panels: 15, percentage: 90 } },
                                heatpump: { enabled: true, inputs: { gasUsage: 1500, householdSize: 4 } },
                                battery: { enabled: false, inputs: { capacity: 0 } }
                            }
                        };
                        break;
                    case 'large':
                        testData = {
                            customer: { name: 'Jan van Berg', email: 'jan@example.com', phone: '06-33333333' },
                            products: {
                                solar: { enabled: true, inputs: { panels: 20 } },
                                heatpump: { enabled: true, inputs: { gasUsage: 2000, householdSize: 5 } },
                                battery: { enabled: true, inputs: { capacity: 15 } }
                            }
                        };
                        break;
                }

                DebugPanel.applyTestData(testData);
                EventManager.showSuccessMessage(`${size.charAt(0).toUpperCase() + size.slice(1)} setup geladen!`);
            },

            // Apply test data to the calculator
            applyTestData: (testData) => {
                // Update calculator state
                Object.assign(CalculatorState.customer, testData.customer);
                
                // Update products
                Object.keys(testData.products).forEach(productKey => {
                    const product = testData.products[productKey];
                    CalculatorState.products[productKey].enabled = product.enabled;
                    Object.assign(CalculatorState.products[productKey].inputs, product.inputs);
                });

                // Update UI and calculations
                UIUpdater.restoreUIFromState();
                EventManager.handleUpdate();
                
                // Save to storage
                StorageManager.save();
            },

            // Clear all data
            clearAllData: () => {
                if (confirm('Alle data wissen? Deze actie kan niet ongedaan gemaakt worden.')) {
                    EventManager.handleReset();
                }
            },

            // Apply custom customer data from debug inputs
            applyCustomerData: () => {
                const name = Utils.getElement('#debug-name')?.value || '';
                const email = Utils.getElement('#debug-email')?.value || '';
                const phone = Utils.getElement('#debug-phone')?.value || '';

                if (name || email || phone) {
                    CalculatorState.customer = { name, email, phone };
                    UIUpdater.updateCustomerInfo();
                    StorageManager.save();
                    EventManager.showSuccessMessage('Klantgegevens toegepast!');
                }
            },

            // Save webhook configuration
            saveConfiguration: () => {
                const webhookUrl = Utils.getElement('#webhook-url')?.value || '';
                const advisorName = Utils.getElement('#advisor-name')?.value || '';
                const appointmentLink = Utils.getElement('#appointment-link')?.value || '';

                CalculatorState.config.webhookUrl = webhookUrl;
                CalculatorState.config.advisorName = advisorName;
                CalculatorState.config.appointmentLink = appointmentLink;

                StorageManager.save();
                EventManager.showSuccessMessage('Configuratie opgeslagen!');
            },

            // Toggle debug mode
            toggleDebugMode: (event) => {
                APP_CONFIG.debug = event.target.checked;
                EventManager.showSuccessMessage(`Debug mode ${APP_CONFIG.debug ? 'ingeschakeld' : 'uitgeschakeld'}`);
            },

            // Load predefined scenarios
            loadScenario: (scenario) => {
                let scenarioData;

                switch (scenario) {
                    case 'starter':
                        scenarioData = {
                            customer: { name: 'Startende Klant', email: 'starter@example.com', phone: '06-10000001' },
                            products: {
                                solar: { enabled: true, inputs: { panels: 10 } },
                                heatpump: { enabled: true, inputs: { gasUsage: 1200, householdSize: 2 } },
                                battery: { enabled: false, inputs: { capacity: 0 } }
                            }
                        };
                        break;
                    case 'family':
                        scenarioData = {
                            customer: { name: 'Familie Scenario', email: 'familie@example.com', phone: '06-20000002' },
                            products: {
                                solar: { enabled: true, inputs: { panels: 15 } },
                                heatpump: { enabled: true, inputs: { gasUsage: 1500, householdSize: 4 } },
                                battery: { enabled: true, inputs: { capacity: 10 } }
                            }
                        };
                        break;
                    case 'premium':
                        scenarioData = {
                            customer: { name: 'Premium Klant', email: 'premium@example.com', phone: '06-30000003' },
                            products: {
                                solar: { enabled: true, inputs: { panels: 20 } },
                                heatpump: { enabled: true, inputs: { gasUsage: 2200, householdSize: 6 } },
                                battery: { enabled: true, inputs: { capacity: 15 } }
                            }
                        };
                        break;
                    case 'invalid':
                        scenarioData = {
                            customer: { name: '', email: 'invalid-email', phone: 'wrong-phone' },
                            products: {
                                solar: { enabled: true, inputs: { panels: -5 } },
                                heatpump: { enabled: true, inputs: { gasUsage: -100, householdSize: 0 } },
                                battery: { enabled: true, inputs: { capacity: -10 } }
                            }
                        };
                        break;
                }

                DebugPanel.applyTestData(scenarioData);
                EventManager.showSuccessMessage(`Scenario "${scenario}" geladen!`);
            },

            // Export current data as JSON
            exportData: () => {
                const exportData = {
                    timestamp: new Date().toISOString(),
                    customer: CalculatorState.customer,
                    products: CalculatorState.products,
                    totals: CalculatorState.totals,
                    config: CalculatorState.config
                };

                const output = Utils.getElement('#debug-output');
                if (output) {
                    output.value = JSON.stringify(exportData, null, 2);
                }
            },

            // View webhook data structure
            viewWebhookData: () => {
                const webhookData = EmailGenerator.prepareEmailData();
                const output = Utils.getElement('#debug-output');
                if (output) {
                    output.value = JSON.stringify(webhookData, null, 2);
                }
            },

            // Test calculations with current data
            testCalculations: () => {
                const results = {
                    solar: CalculationEngine.calculateSolar(CalculatorState.products.solar.inputs.panels || 0, CalculatorState.products.solar.inputs.percentage || 100),
                    heatpump: CalculationEngine.calculateHeatPump(
                        CalculatorState.products.heatpump.inputs.gasUsage || 0,
                        CalculatorState.products.heatpump.inputs.householdSize || 0
                    ),
                    battery: CalculationEngine.calculateBattery(CalculatorState.products.battery.inputs.capacity || 0),
                    totals: CalculationEngine.calculateTotals()
                };

                const output = Utils.getElement('#debug-output');
                if (output) {
                    output.value = JSON.stringify(results, null, 2);
                }
            },

            // Load configuration into debug inputs
            loadConfigFromState: () => {
                const webhookUrl = Utils.getElement('#webhook-url');
                const advisorName = Utils.getElement('#advisor-name');
                const appointmentLink = Utils.getElement('#appointment-link');
                const debugMode = Utils.getElement('#debug-mode');

                if (webhookUrl) webhookUrl.value = CalculatorState.config.webhookUrl || '';
                if (advisorName) advisorName.value = CalculatorState.config.advisorName || '';
                if (appointmentLink) appointmentLink.value = CalculatorState.config.appointmentLink || '';
                if (debugMode) debugMode.checked = APP_CONFIG.debug || false;
            }
        };

        // Event Management System
        const EventManager = {
            // Debounced update function
            debouncedUpdate: null,

            // Initialize event listeners
            init: () => {
                // Create debounced update function
                EventManager.debouncedUpdate = Utils.debounce(
                    EventManager.handleUpdate, 
                    APP_CONFIG.updateDelay
                );

                // Set up input event listeners
                EventManager.setupInputListeners();
                EventManager.setupCheckboxListeners();
                EventManager.setupButtonListeners();
                EventManager.setupConfigListeners();

                if (APP_CONFIG.debug) {
                    console.log('Event listeners initialized');
                }
            },

            // Set up input field listeners
            setupInputListeners: () => {
                // Customer info inputs
                const customerInputs = ['customer-name', 'customer-lastname', 'customer-email'];
                customerInputs.forEach(id => {
                    const element = Utils.getElement(`#${id}`);
                    if (element) {
                        element.addEventListener('input', EventManager.handleCustomerInput);
                        element.addEventListener('blur', EventManager.handleInputValidation);
                    }
                });

                // Agent dropdown and custom input
                const agentSelect = Utils.getElement('#agent-name-select');
                const agentCustom = Utils.getElement('#agent-name-custom');
                
                if (agentSelect) {
                    agentSelect.addEventListener('change', EventManager.handleAgentSelect);
                }
                
                if (agentCustom) {
                    agentCustom.addEventListener('input', EventManager.handleAgentCustomInput);
                    agentCustom.addEventListener('blur', EventManager.handleInputValidation);
                }

                // Product inputs
                const productInputs = [
                    'solar-panels',
                    'solar-percentage',
                    'gas-usage', 
                    'household-size', 
                    'battery-capacity',
                    'loan-amount',
                    'interest-rate',
                    'own-funds'
                ];
                
                productInputs.forEach(id => {
                    const element = Utils.getElement(`#${id}`);
                    if (element) {
                        element.addEventListener('input', EventManager.handleProductInput);
                        element.addEventListener('blur', EventManager.handleInputValidation);
                        // Format numbers on blur
                        if (element.type === 'number') {
                            element.addEventListener('blur', EventManager.formatNumberInput);
                        }
                    }
                });
            },

            // Set up checkbox listeners for product toggles
            setupCheckboxListeners: () => {
                const productCheckboxes = ['solar-enabled', 'heatpump-enabled', 'battery-enabled', 'financing-enabled'];
                productCheckboxes.forEach(id => {
                    const element = Utils.getElement(`#${id}`);
                    if (element) {
                        element.addEventListener('change', EventManager.handleProductToggle);
                    }
                });
                
                // Special handling for loan-term dropdown
                const loanTermSelect = Utils.getElement('#loan-term');
                if (loanTermSelect) {
                    loanTermSelect.addEventListener('change', EventManager.handleLoanTermChange);
                }
            },

            // Set up button listeners
            setupButtonListeners: () => {
                // Generate email button
                const emailButton = Utils.getElement('#generate-email');
                if (emailButton) {
                    emailButton.addEventListener('click', EventManager.handleEmailGeneration);
                }

                // Reset button
                const resetButton = Utils.getElement('#reset-calculator');
                if (resetButton) {
                    resetButton.addEventListener('click', EventManager.handleReset);
                }

                // Debug toggle button
                const debugToggle = Utils.getElement('#debug-toggle');
                if (debugToggle) {
                    debugToggle.addEventListener('click', DebugPanel.toggle);
                }
            },

            // Set up configuration panel listeners
            setupConfigListeners: () => {
                // Config save button
                const saveConfigButton = Utils.getElement('#save-config');
                if (saveConfigButton) {
                    saveConfigButton.addEventListener('click', EventManager.handleConfigSave);
                }

                // Test data button
                const testDataButton = Utils.getElement('#test-data');
                if (testDataButton) {
                    testDataButton.addEventListener('click', EventManager.handleTestData);
                }
            },

            // Handle customer info input changes with validation
            handleCustomerInput: (event) => {
                const field = event.target.id.replace('customer-', '');
                let value = event.target.value;

                // Format phone number automatically as user types
                if (field === 'phone' && value) {
                    const formatted = CustomerValidator.formatDutchPhone(value);
                    if (formatted !== value) {
                        event.target.value = formatted;
                        value = formatted;
                    }
                }

                // Update state
                CalculatorState.customer[field] = value;

                // Validate field in real-time
                const validation = CustomerValidator.validateField(field, value);
                CustomerValidator.showValidation(field, validation);

                // Save to localStorage
                StorageManager.save();

                // Update email button state if customer data changed
                EventManager.updateEmailButtonState();
                
                if (APP_CONFIG.debug) {
                    console.log(`Customer ${field} updated:`, value, 'Valid:', validation.isValid);
                }
            },

            // Handle agent dropdown selection
            handleAgentSelect: (event) => {
                const selectedValue = event.target.value;
                const agentCustom = Utils.getElement('#agent-name-custom');
                
                if (selectedValue === 'custom') {
                    // Show custom input field
                    if (agentCustom) {
                        agentCustom.style.display = 'block';
                        agentCustom.focus();
                    }
                    CalculatorState.customer.agent = '';
                } else if (selectedValue === '') {
                    // No agent selected
                    if (agentCustom) {
                        agentCustom.style.display = 'none';
                        agentCustom.value = '';
                    }
                    CalculatorState.customer.agent = '';
                } else {
                    // Predefined agent selected
                    if (agentCustom) {
                        agentCustom.style.display = 'none';
                        agentCustom.value = '';
                    }
                    CalculatorState.customer.agent = selectedValue;
                    
                    // Validate and show success
                    const validation = CustomerValidator.validateField('agent', selectedValue);
                    CustomerValidator.showValidation('agent', validation);
                }
                
                // Save to localStorage
                StorageManager.save();
                
                if (APP_CONFIG.debug) {
                    console.log('Agent selected:', selectedValue);
                }
            },

            // Handle custom agent name input
            handleAgentCustomInput: (event) => {
                const value = event.target.value;
                CalculatorState.customer.agent = value;
                
                // Validate field in real-time
                const validation = CustomerValidator.validateField('agent', value);
                CustomerValidator.showValidation('agent', validation);
                
                // Save to localStorage
                StorageManager.save();
                
                if (APP_CONFIG.debug) {
                    console.log('Custom agent name:', value, 'Valid:', validation.isValid);
                }
            },

            // Handle product input changes
            handleProductInput: (event) => {
                const rawValue = event.target.value;
                
                // Map input ID to state path and validation category
                const inputMap = {
                    'solar-panels': { product: 'solar', field: 'panels', category: 'solar', validationField: 'panels' },
                    'solar-percentage': { product: 'solar', field: 'percentage', category: 'solar', validationField: 'percentage' },
                    'gas-usage': { product: 'heatpump', field: 'gasUsage', category: 'heatPump', validationField: 'gasUsage' },
                    'household-size': { product: 'heatpump', field: 'householdSize', category: 'heatPump', validationField: 'householdSize' },
                    'battery-capacity': { product: 'battery', field: 'capacity', category: 'battery', validationField: 'capacity' },
                    'loan-amount': { product: 'financing', field: 'loanAmount', category: 'financing', validationField: 'loanAmount' },
                    'interest-rate': { product: 'financing', field: 'interestRate', category: 'financing', validationField: 'interestRate' }
                };
                
                const config = inputMap[event.target.id];
                
                // Special handling for own funds
                if (event.target.id === 'own-funds') {
                    try {
                        const sanitizedValue = ValidationEngine.sanitizeInput('financing', 'loanAmount', rawValue); // Use financing validation for currency
                        const validation = ValidationEngine.validateInput('financing', 'loanAmount', sanitizedValue);
                        
                        // Update the input field if value was sanitized
                        if (sanitizedValue !== rawValue) {
                            event.target.value = sanitizedValue;
                        }
                        
                        // Update calculator state
                        CalculatorState.financialSummary.ownFunds = sanitizedValue || 0;
                        
                        // Show validation feedback
                        EventManager.showInputValidation(event.target, validation);
                        
                        // Trigger debounced update
                        EventManager.debouncedUpdate();
                        
                        if (APP_CONFIG.debug) {
                            console.log(`Own funds updated: raw: ${rawValue} -> sanitized: ${sanitizedValue}, valid: ${validation.isValid}`);
                        }
                    } catch (error) {
                        console.error('Own funds validation error:', error);
                        const value = Utils.parseNumber(rawValue);
                        CalculatorState.financialSummary.ownFunds = value;
                        EventManager.debouncedUpdate();
                    }
                } else if (config) {
                    try {
                        // Sanitize input value
                        const sanitizedValue = ValidationEngine.sanitizeInput(config.category, config.validationField, rawValue);
                        
                        // Validate the sanitized value
                        const validation = ValidationEngine.validateInput(config.category, config.validationField, sanitizedValue);
                        
                        // Update the input field if value was sanitized
                        if (sanitizedValue !== rawValue) {
                            event.target.value = sanitizedValue;
                        }
                        
                        // Update calculator state with sanitized value
                        CalculatorState.products[config.product].inputs[config.field] = sanitizedValue || 0;
                        
                        // Show validation feedback
                        EventManager.showInputValidation(event.target, validation);
                        
                        // Trigger debounced update
                        EventManager.debouncedUpdate();
                        
                        if (APP_CONFIG.debug) {
                            console.log(`Product input ${config.product}.${config.field} updated:`, 
                                       `raw: ${rawValue} -> sanitized: ${sanitizedValue}, valid: ${validation.isValid}`);
                        }
                    } catch (error) {
                        console.error('Product input validation error:', error);
                        // Fallback to basic parsing for compatibility
                        const value = Utils.parseNumber(rawValue);
                        CalculatorState.products[config.product].inputs[config.field] = value;
                        EventManager.debouncedUpdate();
                    }
                }
            },

            // Handle product toggle checkboxes
            handleProductToggle: (event) => {
                const productMap = {
                    'solar-enabled': 'solar',
                    'heatpump-enabled': 'heatpump',
                    'battery-enabled': 'battery',
                    'financing-enabled': 'financing'
                };
                
                const product = productMap[event.target.id];
                if (product) {
                    CalculatorState.products[product].enabled = event.target.checked;
                    
                    // Update UI state
                    const section = Utils.getElement(`#${product === 'heatpump' ? 'heatpump' : product}-section`);
                    if (section) {
                        Utils.toggleClass(section, 'enabled');
                    }
                    
                    // Trigger immediate update
                    EventManager.handleUpdate();
                    
                    if (APP_CONFIG.debug) {
                        console.log(`Product ${product} toggled:`, event.target.checked);
                    }
                }
            },

            // Handle loan term dropdown change
            handleLoanTermChange: (event) => {
                const loanTerm = parseInt(event.target.value);
                if (!isNaN(loanTerm) && loanTerm > 0) {
                    CalculatorState.products.financing.inputs.loanTerm = loanTerm;
                    EventManager.handleUpdate();
                    
                    if (APP_CONFIG.debug) {
                        console.log('Loan term changed to:', loanTerm);
                    }
                }
            },

            // Handle main update logic with enhanced UI feedback
            handleUpdate: () => {
                CalculatorState.ui.isCalculating = true;
                CalculatorState.ui.lastUpdate = new Date().toISOString();
                
                // Show calculating state on all result elements
                const resultElements = document.querySelectorAll('.calculation-result, .total-display');
                UIUpdater.showCalculating(Array.from(resultElements));
                
                // Small delay to show calculating state, then perform calculations
                setTimeout(() => {
                    // Perform calculations
                    CalculationEngine.updateAllCalculations();
                    
                    // Hide calculating state
                    UIUpdater.hideCalculating(Array.from(resultElements));
                    
                    // Update UI displays with animations
                    UIUpdater.updateAllDisplays();
                    
                    // Save current state
                    StorageManager.save();
                    
                    CalculatorState.ui.isCalculating = false;
                    
                    if (APP_CONFIG.debug) {
                        console.log('Calculator update completed:', CalculatorState.totals);
                    }
                }, 50); // Short delay to show loading state
            },

            // Update email button state based on customer data and total savings
            updateEmailButtonState: () => {
                const emailButton = Utils.getElement('#generate-email');
                if (!emailButton) return;

                const customerValid = CustomerValidator.validateAll().isValid;
                const hasCalculations = CalculatorState.totals.year > 0;
                
                emailButton.disabled = !(customerValid && hasCalculations);

                if (APP_CONFIG.debug) {
                    console.log('Email button state:', {
                        customerValid,
                        hasCalculations,
                        disabled: emailButton.disabled
                    });
                }
            },

            // Handle input validation
            handleInputValidation: (event) => {
                const element = event.target;
                const value = element.value;
                let isValid = true;
                let errorMessage = '';
                
                // Clear previous error
                EventManager.clearInputError(element);
                
                // Validation based on input type
                switch (element.type) {
                    case 'email':
                        if (value && !Utils.validateEmail(value)) {
                            isValid = false;
                            errorMessage = 'Voer een geldig emailadres in';
                        }
                        break;
                    case 'tel':
                        if (value && !Utils.validatePhone(value)) {
                            isValid = false;
                            errorMessage = 'Voer een geldig telefoonnummer in';
                        }
                        break;
                    case 'number':
                        const numValue = parseFloat(value);
                        const min = parseFloat(element.min);
                        const max = parseFloat(element.max);
                        
                        if (value && (isNaN(numValue) || numValue < min || (max && numValue > max))) {
                            isValid = false;
                            errorMessage = `Voer een getal in tussen ${min} en ${max || '∞'}`;
                        }
                        break;
                }
                
                // Required field validation
                if (element.required && !value.trim()) {
                    isValid = false;
                    errorMessage = 'Dit veld is verplicht';
                }
                
                if (!isValid) {
                    EventManager.showInputError(element, errorMessage);
                }
                
                return isValid;
            },

            // Format number inputs for display
            formatNumberInput: (event) => {
                const element = event.target;
                if (element.type === 'number' && element.value) {
                    const value = Utils.parseNumber(element.value);
                    if (!isNaN(value)) {
                        // Format based on input type
                        if (element.step === '0.5') {
                            element.value = Utils.formatNumber(value, 1);
                        } else {
                            element.value = Utils.formatNumber(value, 0);
                        }
                    }
                }
            },

            // Show input error
            showInputError: (element, message) => {
                const errorElement = Utils.getElement(`#${element.id}-error`);
                if (errorElement) {
                    errorElement.textContent = message;
                    Utils.addClass(element, 'error');
                }
            },

            // Show validation feedback from ValidationEngine - Step 11
            showInputValidation: (element, validation) => {
                try {
                    // Clear previous validation state
                    EventManager.clearInputError(element);
                    
                    // Get or create validation message elements
                    const elementId = element.id;
                    let messageElement = Utils.getElement(`#${elementId}-validation`);
                    
                    if (!messageElement) {
                        // Create validation message element if it doesn't exist
                        messageElement = document.createElement('div');
                        messageElement.id = `${elementId}-validation`;
                        messageElement.className = 'validation-message';
                        
                        // Insert after the input element
                        const parent = element.parentElement;
                        if (parent) {
                            const nextSibling = element.nextElementSibling;
                            if (nextSibling) {
                                parent.insertBefore(messageElement, nextSibling);
                            } else {
                                parent.appendChild(messageElement);
                            }
                        }
                    }
                    
                    if (validation.isValid && validation.message) {
                        // Show success validation
                        messageElement.textContent = validation.message;
                        messageElement.className = 'validation-message success';
                        Utils.removeClass(element, 'error invalid');
                        Utils.addClass(element, 'valid');
                    } else if (!validation.isValid && validation.message) {
                        // Show error validation
                        messageElement.textContent = validation.message;
                        messageElement.className = 'validation-message error';
                        Utils.removeClass(element, 'valid');
                        Utils.addClass(element, 'invalid error');
                    } else {
                        // Clear validation message
                        messageElement.textContent = '';
                        messageElement.className = 'validation-message';
                        Utils.removeClass(element, 'valid invalid error');
                    }
                } catch (error) {
                    console.error('Error showing validation feedback:', error);
                }
            },

            // Clear input error
            clearInputError: (element) => {
                const errorElement = Utils.getElement(`#${element.id}-error`);
                if (errorElement) {
                    errorElement.textContent = '';
                    Utils.removeClass(element, 'error');
                }
            },

            // Handle email generation (placeholder)
            // Handle email generation via N8N webhook
            handleEmailGeneration: async () => {
                const emailButton = Utils.getElement('#generate-email');
                const emailLoader = Utils.getElement('#email-loader');
                const emailButtonText = emailButton?.querySelector('.button-text');

                if (!emailButton) return;

                // Prevent double-clicks
                if (emailButton.disabled) return;

                try {
                    // Show loading state
                    emailButton.disabled = true;
                    if (emailLoader) {
                        emailLoader.style.display = 'inline';
                    }
                    if (emailButtonText) {
                        emailButtonText.textContent = 'Genereren...';
                    }

                    // Prepare email data
                    const emailData = EmailGenerator.prepareEmailData();
                    
                    // Get webhook URL from config
                    const webhookUrl = CalculatorState.config.webhookUrl || APP_CONFIG.defaultWebhookUrl;
                    
                    if (!webhookUrl) {
                        throw new Error('Geen webhook URL geconfigureerd. Schakel debug mode in om een URL in te stellen.');
                    }

                    if (APP_CONFIG.debug) {
                        console.log('Sending email data to webhook:', webhookUrl, emailData);
                    }

                    // Make webhook request
                    const response = await fetch(webhookUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(emailData)
                    });

                    if (!response.ok) {
                        throw new Error(`Webhook request failed: ${response.status} ${response.statusText}`);
                    }

                    const result = await response.json();
                    
                    if (APP_CONFIG.debug) {
                        console.log('Webhook response:', result);
                    }

                    // Show success message
                    EventManager.showSuccessMessage('Email concept succesvol gegenereerd! Check uw email inbox.');
                    
                    // Optional: Save the email result to state
                    CalculatorState.lastEmailResult = result;

                } catch (error) {
                    console.error('Email generation failed:', error);
                    
                    let errorMessage = 'Er ging iets mis bij het genereren van de email.';
                    
                    if (error.message.includes('webhook URL')) {
                        errorMessage = error.message;
                    } else if (error.message.includes('NetworkError') || error.message.includes('fetch')) {
                        errorMessage = 'Geen internetverbinding of webhook niet bereikbaar.';
                    } else if (error.message.includes('400')) {
                        errorMessage = 'Ongeldige data verzonden naar webhook.';
                    } else if (error.message.includes('401') || error.message.includes('403')) {
                        errorMessage = 'Webhook authenticatie gefaald.';
                    } else if (error.message.includes('500')) {
                        errorMessage = 'Server fout bij email generatie.';
                    }
                    
                    EventManager.showErrorMessage(errorMessage);
                    
                } finally {
                    // Reset loading state
                    emailButton.disabled = false;
                    if (emailLoader) {
                        emailLoader.style.display = 'none';
                    }
                    if (emailButtonText) {
                        emailButtonText.textContent = 'Genereer Email Concept';
                    }
                }
            },

            // Show success message to user
            showSuccessMessage: (message) => {
                EventManager.showMessage(message, 'success');
            },

            // Show error message to user  
            showErrorMessage: (message) => {
                EventManager.showMessage(message, 'error');
            },

            // Generic message display function
            showMessage: (message, type = 'info') => {
                // Create message element
                const messageDiv = document.createElement('div');
                messageDiv.className = `status-message status-${type}`;
                messageDiv.innerHTML = `
                    <span class="message-icon">${type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️'}</span>
                    <span class="message-text">${message}</span>
                    <button class="message-close">✕</button>
                `;

                // Add styles if not already present
                if (!document.querySelector('style[data-message-styles]')) {
                    const styles = document.createElement('style');
                    styles.setAttribute('data-message-styles', 'true');
                    styles.textContent = `
                        .status-message {
                            position: fixed;
                            top: 20px;
                            right: 20px;
                            background: white;
                            border-radius: var(--border-radius);
                            padding: var(--space-md);
                            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                            display: flex;
                            align-items: center;
                            gap: var(--space-sm);
                            max-width: 400px;
                            z-index: 1000;
                            border-left: 4px solid #ccc;
                            animation: slideIn 0.3s ease-out;
                        }
                        
                        .status-message.status-success {
                            border-left-color: var(--color-success);
                            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(34, 197, 94, 0.05));
                        }
                        
                        .status-message.status-error {
                            border-left-color: var(--color-danger);
                            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
                        }
                        
                        .message-icon {
                            font-size: var(--font-size-lg);
                        }
                        
                        .message-text {
                            flex: 1;
                            font-size: var(--font-size-sm);
                            line-height: 1.4;
                        }
                        
                        .message-close {
                            background: none;
                            border: none;
                            font-size: var(--font-size-lg);
                            cursor: pointer;
                            opacity: 0.6;
                            transition: opacity var(--transition-fast);
                        }
                        
                        .message-close:hover {
                            opacity: 1;
                        }
                        
                        @keyframes slideIn {
                            from { transform: translateX(100%); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                        
                        @keyframes slideOut {
                            from { transform: translateX(0); opacity: 1; }
                            to { transform: translateX(100%); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(styles);
                }

                // Add to page
                document.body.appendChild(messageDiv);

                // Auto-remove after delay
                const autoRemoveDelay = type === 'success' ? 5000 : 8000;
                const autoRemoveTimeout = setTimeout(() => {
                    EventManager.removeMessage(messageDiv);
                }, autoRemoveDelay);

                // Manual close handler
                const closeButton = messageDiv.querySelector('.message-close');
                closeButton.addEventListener('click', () => {
                    clearTimeout(autoRemoveTimeout);
                    EventManager.removeMessage(messageDiv);
                });

                if (APP_CONFIG.debug) {
                    console.log(`${type.toUpperCase()} message:`, message);
                }
            },

            // Remove message with animation
            removeMessage: (messageElement) => {
                messageElement.style.animation = 'slideOut 0.3s ease-in forwards';
                setTimeout(() => {
                    if (messageElement.parentNode) {
                        messageElement.parentNode.removeChild(messageElement);
                    }
                }, 300);
            },

            // Handle calculator reset
            handleReset: () => {
                if (confirm('Weet je zeker dat je alle gegevens wilt wissen?')) {
                    // Reset state
                    CalculatorState.customer = { name: '', email: '', phone: '' };
                    CalculatorState.products = {
                        solar: { enabled: false, inputs: { panels: 0, percentage: 100 }, calculations: { kwhYear: 0, savingsYear: 0, savingsMonth: 0 } },
                        heatpump: { enabled: false, inputs: { gasUsage: 0, householdSize: 0 }, calculations: { heatingGas: 0, savedGas: 0, savingsYear: 0, savingsMonth: 0 } },
                        battery: { enabled: false, inputs: { capacity: 0 }, calculations: { imbalanceSavings: 0, feedInSavings: 256, totalSavingsYear: 0, totalSavingsMonth: 0 } },
                        financing: { enabled: false, inputs: { loanAmount: 0, loanTerm: 0, interestRate: 4.5 }, calculations: { monthlyPayment: 0, totalInterest: 0, totalPayment: 0, netMonthlyCost: 0, paybackPeriod: 0 } }
                    };
                    CalculatorState.totals = { year: 0, month: 0, enabledProducts: [] };
                    
                    // Clear localStorage
                    StorageManager.clear();
                    
                    // Reload page to reset UI
                    location.reload();
                }
            },

            // Handle config save (for testing)
            handleConfigSave: () => {
                const webhookUrl = Utils.getElement('#webhook-url')?.value || '';
                const advisorName = Utils.getElement('#advisor-name')?.value || '';
                const appointmentLink = Utils.getElement('#appointment-link')?.value || '';
                
                CalculatorState.config.webhookUrl = webhookUrl;
                CalculatorState.config.advisorName = advisorName;
                CalculatorState.config.appointmentLink = appointmentLink;
                
                StorageManager.save();
                alert('Configuratie opgeslagen!');
            },

            // Handle test data loading
            handleTestData: () => {
                // Load test data
                CalculatorState.customer = {
                    name: 'Jan de Vries',
                    email: 'jan@example.com',
                    phone: '06-12345678'
                };
                
                CalculatorState.products.solar.enabled = true;
                CalculatorState.products.solar.inputs.panels = 12;
                
                CalculatorState.products.heatpump.enabled = true;
                CalculatorState.products.heatpump.inputs.gasUsage = 1500;
                CalculatorState.products.heatpump.inputs.householdSize = 4;
                
                CalculatorState.products.battery.enabled = true;
                CalculatorState.products.battery.inputs.capacity = 10;
                
                // Update UI will be implemented in next steps
                alert('Test data geladen!');
                location.reload();
            }
        };

        // Application Initialization
        const App = {
            // Initialize the application
            init: () => {
                console.log(`${APP_CONFIG.name} v${APP_CONFIG.version} - Initializing...`);
                
                // Load saved data
                if (StorageManager.load()) {
                    console.log('Previous session data loaded');
                }
                
                // Initialize event system
                EventManager.init();
                
                // Initialize debug panel
                DebugPanel.init();
                
                // Restore UI from saved state and perform initial calculations
                UIUpdater.restoreUIFromState();
                
                // Set up development mode
                if (APP_CONFIG.debug || window.location.search.includes('debug=true')) {
                    App.enableDebugMode();
                }
                
                console.log(`${APP_CONFIG.name} - Ready!`);
            },

            // Enable debug mode
            enableDebugMode: () => {
                APP_CONFIG.debug = true;
                console.log('Debug mode enabled');
                
                // Show config panel
                const configPanel = Utils.getElement('#config-panel');
                if (configPanel) {
                    configPanel.style.display = 'block';
                }
                
                // Expose global variables for debugging
                window.CalculatorState = CalculatorState;
                window.Utils = Utils;
                window.StorageManager = StorageManager;
                window.APP_CONFIG = APP_CONFIG;
            },

            // Get current state for debugging
            getState: () => {
                return {
                    ...CalculatorState,
                    timestamp: new Date().toISOString()
                };
            }
        };

        // Initialize application when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', App.init);
        } else {
            App.init();
        }

        // Expose App for debugging
        window.VolteraCalculator = App;

        /* ===== STEP 12: DESKTOP-FOCUSED UI POLISH ENHANCEMENTS ===== */
        
        // Enhanced Email Generation with Loading States
        const EmailGeneration = {
            // Show loading state during email generation
            showLoadingState: () => {
                const button = Utils.getElement('#generate-email');
                const loader = Utils.getElement('.button-loader');
                
                if (button) {
                    Utils.addClass(button, 'loading');
                    button.disabled = true;
                    button.style.cursor = 'wait';
                    
                    if (loader) {
                        loader.style.display = 'inline-block';
                    }
                }
                
                // Add progress indicator
                EmailGeneration.updateProgressBar(0);
                setTimeout(() => EmailGeneration.updateProgressBar(30), 200);
                setTimeout(() => EmailGeneration.updateProgressBar(60), 600);
                setTimeout(() => EmailGeneration.updateProgressBar(90), 1000);
            },
            
            // Hide loading state
            hideLoadingState: () => {
                const button = Utils.getElement('#generate-email');
                const loader = Utils.getElement('.button-loader');
                
                if (button) {
                    Utils.removeClass(button, 'loading');
                    button.disabled = false;
                    button.style.cursor = 'pointer';
                    
                    if (loader) {
                        loader.style.display = 'none';
                    }
                }
                
                EmailGeneration.updateProgressBar(100);
                setTimeout(() => EmailGeneration.updateProgressBar(0), 1000);
            },
            
            // Update progress bar
            updateProgressBar: (percentage) => {
                const progressBar = Utils.getElement('.progress-bar');
                if (progressBar) {
                    progressBar.style.width = `${percentage}%`;
                }
            }
        };

        // Enhanced Keyboard Navigation for Desktop Users
        const KeyboardNavigation = {
            init: () => {
                document.addEventListener('keydown', KeyboardNavigation.handleKeyDown);
                KeyboardNavigation.setupTabOrder();
            },
            
            // Handle keyboard shortcuts
            handleKeyDown: (e) => {
                // Escape key - clear all inputs
                if (e.key === 'Escape') {
                    if (confirm('Alle invoer wissen?')) {
                        KeyboardNavigation.clearAllInputs();
                    }
                    return;
                }
                
                // Ctrl/Cmd + Enter - Generate email
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    const emailButton = Utils.getElement('#generate-email');
                    if (emailButton && !emailButton.disabled) {
                        emailButton.click();
                    }
                    return;
                }
                
                // F1 - Toggle debug panel
                if (e.key === 'F1') {
                    e.preventDefault();
                    const debugPanel = Utils.getElement('#config-panel');
                    if (debugPanel) {
                        const isVisible = debugPanel.style.display !== 'none';
                        debugPanel.style.display = isVisible ? 'none' : 'block';
                    }
                    return;
                }
                
                // Tab navigation enhancement
                if (e.key === 'Tab') {
                    KeyboardNavigation.handleTabNavigation(e);
                }
            },
            
            // Setup proper tab order for accessibility
            setupTabOrder: () => {
                const inputs = Utils.getElements('input, select, button, textarea');
                inputs.forEach((input, index) => {
                    if (!input.hasAttribute('tabindex')) {
                        input.setAttribute('tabindex', index + 1);
                    }
                });
            },
            
            // Enhanced tab navigation
            handleTabNavigation: (e) => {
                const focusableElements = Array.from(Utils.getElements(
                    'input:not([disabled]), select:not([disabled]), button:not([disabled]), textarea:not([disabled])'
                )).filter(el => el.offsetParent !== null); // Only visible elements
                
                const currentIndex = focusableElements.indexOf(document.activeElement);
                
                if (e.shiftKey) {
                    // Shift+Tab - go backwards
                    if (currentIndex <= 0) {
                        e.preventDefault();
                        focusableElements[focusableElements.length - 1].focus();
                    }
                } else {
                    // Tab - go forwards
                    if (currentIndex >= focusableElements.length - 1) {
                        e.preventDefault();
                        focusableElements[0].focus();
                    }
                }
            },
            
            // Clear all inputs
            clearAllInputs: () => {
                const inputs = Utils.getElements('input[type="number"], input[type="text"], input[type="email"], input[type="tel"]');
                inputs.forEach(input => {
                    input.value = '';
                    input.dispatchEvent(new Event('input', { bubbles: true }));
                });
            }
        };

        // Smooth Animations and Transitions
        const AnimationEffects = {
            init: () => {
                AnimationEffects.setupHoverEffects();
                AnimationEffects.setupScrollEffects();
            },
            
            // Enhanced hover effects for desktop
            setupHoverEffects: () => {
                const sections = Utils.getElements('.product-section');
                sections.forEach(section => {
                    section.addEventListener('mouseenter', () => {
                        AnimationEffects.animateHoverIn(section);
                    });
                    
                    section.addEventListener('mouseleave', () => {
                        AnimationEffects.animateHoverOut(section);
                    });
                });
            },
            
            // Hover in animation
            animateHoverIn: (element) => {
                element.style.transform = 'translateY(-2px)';
                element.style.boxShadow = '0 8px 25px rgba(0, 0, 0, 0.1)';
                element.style.borderColor = '#6366f1';
            },
            
            // Hover out animation
            animateHoverOut: (element) => {
                element.style.transform = 'translateY(0)';
                element.style.boxShadow = '0 2px 10px rgba(0, 0, 0, 0.1)';
                element.style.borderColor = '#e2e8f0';
            },
            
            // Scroll-based effects
            setupScrollEffects: () => {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            Utils.addClass(entry.target, 'animate-in');
                        }
                    });
                }, {
                    threshold: 0.1
                });
                
                const animatedElements = Utils.getElements('.product-section, .actions-section');
                animatedElements.forEach(el => observer.observe(el));
            }
        };

        // Professional Feedback System
        const FeedbackSystem = {
            // Show success message
            showSuccess: (message, duration = 4000) => {
                FeedbackSystem.showMessage(message, 'success', duration);
            },
            
            // Show error message
            showError: (message, duration = 6000) => {
                FeedbackSystem.showMessage(message, 'error', duration);
            },
            
            // Show info message
            showInfo: (message, duration = 3000) => {
                FeedbackSystem.showMessage(message, 'info', duration);
            },
            
            // Show message with animation
            showMessage: (message, type, duration) => {
                const container = Utils.getElement('#status-messages');
                if (!container) return;
                
                const messageEl = document.createElement('div');
                messageEl.className = `status-message status-${type}`;
                messageEl.innerHTML = `
                    <span class="status-icon">${FeedbackSystem.getIcon(type)}</span>
                    <span class="status-text">${message}</span>
                    <button class="status-close" onclick="this.parentElement.remove()">×</button>
                `;
                
                container.appendChild(messageEl);
                
                // Animate in
                setTimeout(() => Utils.addClass(messageEl, 'show'), 10);
                
                // Auto remove
                setTimeout(() => {
                    Utils.removeClass(messageEl, 'show');
                    setTimeout(() => messageEl.remove(), 300);
                }, duration);
            },
            
            // Get icon for message type
            getIcon: (type) => {
                const icons = {
                    success: '✓',
                    error: '⚠',
                    info: 'ℹ'
                };
                return icons[type] || 'ℹ';
            }
        };

        // Enhanced Webhook Integration with Better UX
        const EnhancedWebhook = {
            // Override original webhook call with better UX
            sendEmailRequest: async (data) => {
                try {
                    EmailGeneration.showLoadingState();
                    FeedbackSystem.showInfo('E-mail wordt gegenereerd...');
                    
                    const webhookUrl = CalculatorState.config.webhookUrl || APP_CONFIG.defaultWebhookUrl;
                    
                    const response = await fetch(webhookUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    
                    EmailGeneration.hideLoadingState();
                    FeedbackSystem.showSuccess('E-mail succesvol gegenereerd en verzonden!');
                    
                    return result;
                    
                } catch (error) {
                    EmailGeneration.hideLoadingState();
                    FeedbackSystem.showError(`Fout bij genereren e-mail: ${error.message}`);
                    throw error;
                }
            }
        };

        // Initialize Step 12 enhancements
        document.addEventListener('DOMContentLoaded', () => {
            // Small delay to ensure DOM is fully ready
            setTimeout(() => {
                KeyboardNavigation.init();
                AnimationEffects.init();
                
                // Add keyboard shortcuts info to footer
                const footer = Utils.getElement('body');
                if (footer) {
                    const shortcutsInfo = document.createElement('div');
                    shortcutsInfo.style.cssText = `
                        position: fixed;
                        bottom: 10px;
                        right: 10px;
                        background: rgba(0,0,0,0.8);
                        color: white;
                        padding: 5px 10px;
                        border-radius: 4px;
                        font-size: 11px;
                        opacity: 0.6;
                        z-index: 1000;
                    `;
                    shortcutsInfo.innerHTML = 'Ctrl+Enter: E-mail | Esc: Wissen | F1: Debug';
                    footer.appendChild(shortcutsInfo);
                }
                
                // Override the original email generation with enhanced version
                const originalGenerateEmail = Utils.getElement('#generate-email');
                if (originalGenerateEmail) {
                    originalGenerateEmail.addEventListener('click', async (e) => {
                        e.preventDefault();
                        
                        // Use enhanced webhook with better UX
                        try {
                            const emailData = {
                                customer: CalculatorState.customer,
                                products: CalculatorState.products,
                                totals: CalculatorState.totals,
                                config: CalculatorState.config,
                                timestamp: new Date().toISOString()
                            };
                            
                            await EnhancedWebhook.sendEmailRequest(emailData);
                        } catch (error) {
                            console.error('Email generation failed:', error);
                        }
                    });
                }
                
                console.log('Step 12: Desktop-focused UI polish complete!');
            }, 100);
        });
        
    </script>
</body>
</html>